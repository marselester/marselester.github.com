<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width" />

    <title>marselester's blog - python</title>

    <link rel="stylesheet" href="http://marselester.ru/theme/css/normalize.css" />
    <link rel="stylesheet" href="http://marselester.ru/theme/css/foundation.min.css" />
    <link rel="stylesheet" href="http://marselester.ru/theme/css/style.css" />
    <link rel="stylesheet" href="http://marselester.ru/theme/css/pygments.css" />	
    <script src="http://marselester.ru/theme/js/custom.modernizr.js"></script>
</head>

<body>

<!-- Nav Bar -->
<nav>
<div class="top-bar">
<div class="row">
    <div class="large-9 large-centered columns">
	    <h1><a href="http://marselester.ru">marselester's blog</a></h1>
    </div>
</div>
</div>

<!-- Show menu items and pages -->
<div class="row">
<div class="large-9 columns">
    <ul class="button-group navigation">
    <li><a href="http://marselester.ru/cv/" class="button secondary small">CV</a></li>

            <li><a href="http://marselester.ru/pages/about.html" class="button secondary small">About</a></li>
    </ul>
</div>
</div>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->
<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns">
        
        

            <article>
                <a href="http://marselester.ru/developing-django-project-with-saltstack.html"><h3 class="article-title">Developing Django project with SaltStack</h3></a>
<h6 class="subheader" title="2013-11-09T00:00:00">Sat 09 November 2013
</h6>


<p>Let's use <a class="reference external" href="https://github.com/marselester/abstract-internal-messaging">Messaging System</a> as an example of Django project. I want it to
run in VirtualBox which is managed by Vagrant. Infrastructure management
is provided by SaltStack.</p>
<p>I advise you to create separate folder for repositories (currently there
is only one) of project and clone <a class="reference external" href="https://github.com/marselester/abstract-internal-messaging">Messaging System</a> there.
Also I need a folder for Vagrant files and prefer to name it <tt class="docutils literal">vagrant</tt>.</p>
<div class="highlight"><pre><span class="gp">$</span> mkdir messaging
<span class="gp">$</span> <span class="nb">cd </span>messaging
<span class="gp">$</span> git clone git@github.com:marselester/abstract-internal-messaging.git
<span class="gp">$</span> mkdir abstract-internal-messaging/vagrant
</pre></div>
<p>In order to make friends of Vagrant and SaltStack, I need to install
Salty Vagrant:</p>
<div class="highlight"><pre><span class="gp">$</span> vagrant plugin install vagrant-salt
</pre></div>
<p>I want Vagrant to:</p>
<ul class="simple">
<li>share source code folder <tt class="docutils literal"><span class="pre">messaging/abstract-internal-messaging</span></tt>;</li>
<li>share states and pillars of SaltStack
<tt class="docutils literal"><span class="pre">messaging/abstract-internal-messaging/vagrant/salt/roots</span></tt>;</li>
<li>run minion masterless by <tt class="docutils literal"><span class="pre">salt-call</span> state.highstate</tt>;</li>
<li>assign convenient host name, here it is &quot;messaging-part-1&quot;.</li>
</ul>
<p><tt class="docutils literal">vagrant/Vagrantfile</tt> config responses for these requirements:</p>
<div class="highlight"><pre><span class="c1"># -*- mode: ruby -*-</span>

<span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s1">&#39;precise64&#39;</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box_url</span> <span class="o">=</span> <span class="s1">&#39;http://files.vagrantup.com/precise64.box&#39;</span>

  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="ss">:virtualbox</span> <span class="k">do</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span>
    <span class="n">v</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s1">&#39;modifyvm&#39;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s1">&#39;--name&#39;</span><span class="p">,</span> <span class="s1">&#39;messaging-part-1&#39;</span><span class="o">]</span>
    <span class="n">v</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s1">&#39;modifyvm&#39;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s1">&#39;--memory&#39;</span><span class="p">,</span> <span class="mi">1024</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;messaging-part-1&#39;</span>

  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="ss">:private_network</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s1">&#39;1.2.3.4&#39;</span>

  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">synced_folder</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/vagrant/abstract-internal-messaging&#39;</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">synced_folder</span> <span class="s1">&#39;salt/roots&#39;</span><span class="p">,</span> <span class="s1">&#39;/srv&#39;</span>

  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="ss">:salt</span> <span class="k">do</span> <span class="o">|</span><span class="n">salt</span><span class="o">|</span>
    <span class="n">salt</span><span class="o">.</span><span class="n">minion_config</span> <span class="o">=</span> <span class="s1">&#39;salt/minion.conf&#39;</span>
    <span class="n">salt</span><span class="o">.</span><span class="n">run_highstate</span> <span class="o">=</span> <span class="kp">true</span>
    <span class="n">salt</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
<p>As you could notice, I have not had the <tt class="docutils literal">vagrant/salt</tt> folder yet.
Let's create following directory structure (actually you can just
<tt class="docutils literal">git checkout <span class="pre">salted-vagrant</span></tt>):</p>
<div class="highlight"><pre><span class="gp">$</span> tree abstract-internal-messaging/vagrant
<span class="go">abstract-internal-messaging/vagrant</span>
<span class="go">|-- Vagrantfile</span>
<span class="go">`-- salt</span>
<span class="go">    |-- minion.conf</span>
<span class="go">    `-- roots</span>
<span class="go">        |-- pillar</span>
<span class="go">        |   |-- top.sls</span>
<span class="go">        |   |-- postgresql.sls</span>
<span class="go">        |   `-- website.sls</span>
<span class="go">        `-- salt</span>
<span class="go">            |-- top.sls</span>
<span class="go">            |-- user.sls</span>
<span class="go">            |-- source_code.sls</span>
<span class="go">            |-- python.sls</span>
<span class="go">            |-- redis.sls</span>
<span class="go">            |-- postgresql</span>
<span class="go">            |   |-- init.sls</span>
<span class="go">            |   `-- pg_hba.conf</span>
<span class="go">            `-- website</span>
<span class="go">                |-- django.sls</span>
<span class="go">                |-- wsgiserver.sls</span>
<span class="go">                |-- webserver.sls</span>
<span class="go">                |-- local.py.template</span>
<span class="go">                |-- supervisord.conf</span>
<span class="go">                |-- gunicorn.conf.py</span>
<span class="go">                `-- nginx.conf</span>
</pre></div>
<p><tt class="docutils literal">minion.conf</tt> contains only one string:</p>
<div class="highlight"><pre><span class="l-Scalar-Plain">file_client</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">local</span>
</pre></div>
<p>It means &quot;Don't look for master server when running <tt class="docutils literal"><span class="pre">salt-call</span></tt>&quot;.
It will assume that the local system has all of the file and pillar resources.</p>
<p>Rest of files I will consider separately.</p>
<div class="section" id="user-and-source-code-states">
<h2>User and Source Code states</h2>
<p><tt class="docutils literal">salt/user.sls</tt> creates user &quot;jon_snow&quot;.</p>
<div class="highlight"><pre><span class="l-Scalar-Plain">jon_snow</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">user.present</span>
</pre></div>
<p><tt class="docutils literal">salt/source_code.sls</tt> makes shared source code available in jon_snow's home
by creating symlink.</p>
<div class="highlight"><pre><span class="l-Scalar-Plain">messaging source code</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">file</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">symlink</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/home/jon_snow/abstract-internal-messaging</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">target</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/home/vagrant/abstract-internal-messaging</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">force</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">True</span>
</pre></div>
<p>Hardcoded path can be replaced by <tt class="docutils literal">{{ <span class="pre">pillar['website_src_dir']</span> }}</tt>,
which will be introduced further.</p>
</div>
<div class="section" id="python-state">
<h2>Python state</h2>
<p><tt class="docutils literal">salt/python.sls</tt> installs Python 2, pip and Virtualenv.</p>
<div class="highlight"><pre><span class="l-Scalar-Plain">python2</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">installed</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">names</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">python-dev</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">python</span>

<span class="l-Scalar-Plain">pip</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">installed</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">python-pip</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">require</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">python2</span>

<span class="l-Scalar-Plain">virtualenv</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">pip</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">installed</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">require</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pip</span>
</pre></div>
</div>
<div class="section" id="redis-and-postgresql-states">
<h2>Redis and PostgreSQL states</h2>
<p><tt class="docutils literal">salt/redis.sls</tt> installs Redis.</p>
<div class="highlight"><pre><span class="l-Scalar-Plain">redis-server</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">pkg.installed</span>
</pre></div>
<p><tt class="docutils literal">salt/postgresql/init.sls</tt> installs PostgreSQL 9.1, copies <tt class="docutils literal">pg_hba.conf</tt>,
starts <tt class="docutils literal">postgresql</tt> service, creates user and database based on pillar's
data.</p>
<div class="highlight"><pre><span class="l-Scalar-Plain">postgresql</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">installed</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">names</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">postgresql-9.1</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">python-dev</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">libpq-dev</span>

  <span class="l-Scalar-Plain">service.running</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">watch</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">file</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/etc/postgresql/9.1/main/pg_hba.conf</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">require</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">postgresql</span>

  <span class="l-Scalar-Plain">file.managed</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/etc/postgresql/9.1/main/pg_hba.conf</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">salt://postgresql/pg_hba.conf</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">postgres</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">group</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">postgres</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">mode</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">644</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">require</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">postgresql</span>

<span class="l-Scalar-Plain">postgresql-database-setup</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">postgres_user</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">present</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="p-Indicator">{{</span> <span class="nv">pillar</span><span class="p-Indicator">[</span><span class="s">&#39;postgresql_user&#39;</span><span class="p-Indicator">]</span> <span class="p-Indicator">}}</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">password</span><span class="p-Indicator">:</span> <span class="p-Indicator">{{</span> <span class="nv">pillar</span><span class="p-Indicator">[</span><span class="s">&#39;postgresql_password&#39;</span><span class="p-Indicator">]</span> <span class="p-Indicator">}}</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">createdb</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">True</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">postgres</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">require</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">service</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">postgresql</span>

  <span class="l-Scalar-Plain">postgres_database</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">present</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="p-Indicator">{{</span> <span class="nv">pillar</span><span class="p-Indicator">[</span><span class="s">&#39;postgresql_db&#39;</span><span class="p-Indicator">]</span> <span class="p-Indicator">}}</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">encoding</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">UTF8</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">lc_ctype</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">en_US.UTF8</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">lc_collate</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">en_US.UTF8</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">template</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">template0</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">owner</span><span class="p-Indicator">:</span> <span class="p-Indicator">{{</span> <span class="nv">pillar</span><span class="p-Indicator">[</span><span class="s">&#39;postgresql_user&#39;</span><span class="p-Indicator">]</span> <span class="p-Indicator">}}</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">postgres</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">require</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">postgres_user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">postgresql-database-setup</span>
</pre></div>
<p><tt class="docutils literal">pillar/postgresql.sls</tt></p>
<div class="highlight"><pre><span class="l-Scalar-Plain">postgresql_user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">jon_snow</span>
<span class="l-Scalar-Plain">postgresql_password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ghost</span>
<span class="l-Scalar-Plain">postgresql_db</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">jon_snow</span>
</pre></div>
<p><tt class="docutils literal">salt/postgresql/pg_hba.conf</tt></p>
<div class="highlight"><pre><span class="c1"># This file controls: which hosts are allowed to connect, how clients</span>
<span class="c1"># are authenticated, which PostgreSQL user names they can use, which</span>
<span class="c1"># databases they can access. Records take one of these forms:</span>
<span class="c1">#</span>
<span class="c1"># local DATABASE        USER            METHOD  [OPTIONS]</span>
<span class="l-Scalar-Plain">local   jon_snow        jon_snow        md5</span>

<span class="l-Scalar-Plain"># Database administrative login by Unix domain socket</span>
<span class="l-Scalar-Plain">local   all             postgres                                peer</span>

<span class="l-Scalar-Plain"># TYPE  DATABASE        USER            ADDRESS                 METHOD</span>

<span class="l-Scalar-Plain"># &quot;local&quot; is for Unix domain socket connections only</span>
<span class="l-Scalar-Plain">local   all             all                                     trust</span>
<span class="l-Scalar-Plain"># IPv4 local connections</span><span class="p-Indicator">:</span>
<span class="l-Scalar-Plain">host    all             all             127.0.0.1/32            md5</span>
</pre></div>
</div>
<div class="section" id="website-s-django-state">
<h2>Website's Django state</h2>
<p><tt class="docutils literal">salt/website/django.sls</tt> creates virtual environment and installs
project's dependencies there. It copies django settings, collects static
files and migrate db as well.</p>
<div class="highlight"><pre><span class="p-Indicator">{{</span> <span class="nv">pillar</span><span class="p-Indicator">[</span><span class="s">&#39;website_venv_dir&#39;</span><span class="p-Indicator">]</span> <span class="p-Indicator">}}:</span>
  <span class="l-Scalar-Plain">file</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">directory</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">jon_snow</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">group</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">jon_snow</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">makedirs</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">True</span>

  <span class="l-Scalar-Plain">virtualenv</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">managed</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">no_site_packages</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">True</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">distribute</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">True</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">requirements</span><span class="p-Indicator">:</span> <span class="p-Indicator">{{</span> <span class="nv">pillar</span><span class="p-Indicator">[</span><span class="s">&#39;website_requirements_path&#39;</span><span class="p-Indicator">]</span> <span class="p-Indicator">}}</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">jon_snow</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">no_chown</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">True</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">require</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pip</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">virtualenv</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">file</span><span class="p-Indicator">:</span> <span class="p-Indicator">{{</span> <span class="nv">pillar</span><span class="p-Indicator">[</span><span class="s">&#39;website_venv_dir&#39;</span><span class="p-Indicator">]</span> <span class="p-Indicator">}}</span>

<span class="l-Scalar-Plain">django settings</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">file</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">managed</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="p-Indicator">{{</span> <span class="nv">pillar</span><span class="p-Indicator">[</span><span class="s">&#39;website_settings_path&#39;</span><span class="p-Indicator">]</span> <span class="p-Indicator">}}</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">salt://website/local.py.template</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">template</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">jinja</span>

<span class="l-Scalar-Plain">django-admin collectstatic</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">module</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">run</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">django.collectstatic</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">bin_env</span><span class="p-Indicator">:</span> <span class="p-Indicator">{{</span> <span class="nv">pillar</span><span class="p-Indicator">[</span><span class="s">&#39;website_venv_dir&#39;</span><span class="p-Indicator">]</span> <span class="p-Indicator">}}</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">settings_module</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">messaging.settings.local</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pythonpath</span><span class="p-Indicator">:</span> <span class="p-Indicator">{{</span> <span class="nv">pillar</span><span class="p-Indicator">[</span><span class="s">&#39;website_src_dir&#39;</span><span class="p-Indicator">]</span> <span class="p-Indicator">}}</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">noinput</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">True</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">require</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">virtualenv</span><span class="p-Indicator">:</span> <span class="p-Indicator">{{</span> <span class="nv">pillar</span><span class="p-Indicator">[</span><span class="s">&#39;website_venv_dir&#39;</span><span class="p-Indicator">]</span> <span class="p-Indicator">}}</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">file</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">django settings</span>

<span class="l-Scalar-Plain">django-admin migrate</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">module</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">run</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">django.syncdb</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">bin_env</span><span class="p-Indicator">:</span> <span class="p-Indicator">{{</span> <span class="nv">pillar</span><span class="p-Indicator">[</span><span class="s">&#39;website_venv_dir&#39;</span><span class="p-Indicator">]</span> <span class="p-Indicator">}}</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">settings_module</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">messaging.settings.local</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pythonpath</span><span class="p-Indicator">:</span> <span class="p-Indicator">{{</span> <span class="nv">pillar</span><span class="p-Indicator">[</span><span class="s">&#39;website_src_dir&#39;</span><span class="p-Indicator">]</span> <span class="p-Indicator">}}</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">migrate</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">True</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">require</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">virtualenv</span><span class="p-Indicator">:</span> <span class="p-Indicator">{{</span> <span class="nv">pillar</span><span class="p-Indicator">[</span><span class="s">&#39;website_venv_dir&#39;</span><span class="p-Indicator">]</span> <span class="p-Indicator">}}</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">file</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">django settings</span>
</pre></div>
<p>State above actively uses pillar file <tt class="docutils literal">pillar/website.sls</tt>:</p>
<div class="highlight"><pre><span class="l-Scalar-Plain">website_venv_dir</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/home/jon_snow/venv</span>
<span class="l-Scalar-Plain">website_venv_activate_path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/home/jon_snow/venv/bin/activate</span>
<span class="l-Scalar-Plain">website_src_dir</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/home/jon_snow/abstract-internal-messaging</span>
<span class="l-Scalar-Plain">website_requirements_path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/home/jon_snow/abstract-internal-messaging/requirements_tests.txt</span>
<span class="l-Scalar-Plain">website_settings_path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/home/jon_snow/abstract-internal-messaging/messaging/settings/local.py</span>
<span class="l-Scalar-Plain">website_static_dir</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/home/jon_snow/abstract-internal-messaging/collected_static/</span>

<span class="l-Scalar-Plain">website_gunicorn_bin_path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/home/jon_snow/venv/bin/gunicorn</span>
<span class="l-Scalar-Plain">website_gunicorn_conf_path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/home/jon_snow/gunicorn.conf.py</span>
</pre></div>
<p>Here is <tt class="docutils literal">salt/website/local.py.template</tt>:</p>
<div class="highlight"><pre><span class="c"># coding: utf-8</span>
<span class="kn">from</span> <span class="nn">.dev</span> <span class="kn">import</span> <span class="o">*</span>


<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&quot;django.db.backends.postgresql_psycopg2&quot;</span><span class="p">,</span>
        <span class="s">&#39;NAME&#39;</span><span class="p">:</span> <span class="s">&quot;{{ pillar[&#39;postgresql_db&#39;] }}&quot;</span><span class="p">,</span>
        <span class="s">&#39;USER&#39;</span><span class="p">:</span> <span class="s">&quot;{{ pillar[&#39;postgresql_user&#39;] }}&quot;</span><span class="p">,</span>
        <span class="s">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s">&quot;{{ pillar[&#39;postgresql_password&#39;] }}&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">&#39;some secret key&#39;</span>
</pre></div>
</div>
<div class="section" id="website-s-wsgi-server-state">
<h2>Website's WSGI Server state</h2>
<p><tt class="docutils literal">salt/website/wsgiserver.sls</tt> provides supervisored gunicorn running.</p>
<div class="highlight"><pre><span class="l-Scalar-Plain">supervisord conf</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">file</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">managed</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/etc/supervisor/conf.d/website_gunicorn.conf</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">salt://website/supervisord.conf</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">template</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">jinja</span>

<span class="l-Scalar-Plain">gunicorn conf</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">file</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">managed</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="p-Indicator">{{</span> <span class="nv">pillar</span> <span class="p-Indicator">[</span><span class="s">&#39;website_gunicorn_conf_path&#39;</span><span class="p-Indicator">]</span> <span class="p-Indicator">}}</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">salt://website/gunicorn.conf.py</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">jon_snow</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">group</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">jon_snow</span>

<span class="l-Scalar-Plain">supervisor</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">installed</span>

<span class="l-Scalar-Plain">supervisored gunicorn</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">supervisord</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">running</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">website_gunicorn</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">update</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">True</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">restart</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">True</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">watch</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">file</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">supervisord conf</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">file</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">gunicorn conf</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">require</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">supervisor</span>
</pre></div>
<p><tt class="docutils literal">salt/website/gunicorn.conf.py</tt></p>
<div class="highlight"><pre><span class="c"># coding: utf-8</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>


<span class="n">bind</span> <span class="o">=</span> <span class="s">&#39;127.0.0.1:5000&#39;</span>
<span class="n">workers</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span>
</pre></div>
<p><tt class="docutils literal">salt/website/supervisord.conf</tt></p>
<div class="highlight"><pre><span class="p-Indicator">[</span><span class="nv">program</span><span class="p-Indicator">:</span><span class="nv">website_gunicorn</span><span class="p-Indicator">]</span>
<span class="l-Scalar-Plain">command = {{ pillar[&#39;website_gunicorn_bin_path&#39;] }} -c {{ pillar[&#39;website_gunicorn_conf_path&#39;] }} messaging.wsgi:application</span>
<span class="l-Scalar-Plain">directory = {{ pillar[&#39;website_src_dir&#39;] }}</span>
<span class="l-Scalar-Plain">user = vagrant</span>
<span class="l-Scalar-Plain">autostart = true</span>
<span class="l-Scalar-Plain">autorestart = true</span>
<span class="l-Scalar-Plain">redirect_stderr = True</span>
<span class="l-Scalar-Plain">stdout_logfile = /var/log/supervisor/website_gunicorn.log</span>
</pre></div>
</div>
<div class="section" id="website-s-web-server-state">
<h2>Website's Web Server state</h2>
<p><tt class="docutils literal">salt/website/webserver.sls</tt> installs latest stable Nginx, copies config
file and runs service.</p>
<div class="highlight"><pre><span class="l-Scalar-Plain">nginx</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">pkgrepo</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">managed</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">deb http://nginx.org/packages/ubuntu/ precise nginx</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">key_url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://nginx.org/keys/nginx_signing.key</span>

  <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">installed</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">require</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pkgrepo</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">nginx</span>

  <span class="l-Scalar-Plain">service</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">running</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">watch</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">nginx</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">file</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/etc/nginx/nginx.conf</span>

<span class="l-Scalar-Plain">/etc/nginx/nginx.conf</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">file</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">managed</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">salt://website/nginx.conf</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">root</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">group</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">root</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">mode</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">644</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">template</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">jinja</span>
</pre></div>
<p>Notable in <tt class="docutils literal">salt/website/nginx.conf</tt> is <tt class="docutils literal">sendfile off</tt>. It fixes
<a class="reference external" href="http://jeremyfelt.com/code/2013/01/08/clear-nginx-cache-in-vagrant/">trouble</a>
when Nginx runs in a virtual machine environment.</p>
<div class="highlight"><pre><span class="l-Scalar-Plain">worker_processes 2;</span>


<span class="l-Scalar-Plain">events {</span>
    <span class="l-Scalar-Plain">worker_connections 1024;</span>
<span class="l-Scalar-Plain">}</span>


<span class="l-Scalar-Plain">http {</span>
    <span class="l-Scalar-Plain">include mime.types;</span>
    <span class="l-Scalar-Plain">default_type application/octet-stream;</span>

    <span class="l-Scalar-Plain">sendfile off;</span>

    <span class="l-Scalar-Plain">keepalive_timeout 65;</span>

    <span class="l-Scalar-Plain">server {</span>
        <span class="l-Scalar-Plain">listen 80;</span>
        <span class="l-Scalar-Plain">server_name messaging-part-1;</span>

        <span class="l-Scalar-Plain">location /static/ {</span>
            <span class="l-Scalar-Plain">alias {{ pillar[&#39;website_static_dir&#39;] }};</span>
        <span class="l-Scalar-Plain">}</span>

        <span class="l-Scalar-Plain">location / {</span>
            <span class="l-Scalar-Plain">proxy_pass http://localhost:5000;</span>
            <span class="l-Scalar-Plain">proxy_redirect off;</span>
            <span class="l-Scalar-Plain">proxy_set_header Host $host;</span>
            <span class="l-Scalar-Plain">proxy_set_header X-Real-IP $remote_addr;</span>
            <span class="l-Scalar-Plain">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span>
        <span class="l-Scalar-Plain">}</span>

        <span class="l-Scalar-Plain"># Redirects server error pages to the static page /50x.html</span>
        <span class="l-Scalar-Plain">error_page 500 502 503 504 /50x.html;</span>
        <span class="l-Scalar-Plain">location = /50x.html {</span>
            <span class="l-Scalar-Plain">root html;</span>
        <span class="l-Scalar-Plain">}</span>
    <span class="l-Scalar-Plain">}</span>
<span class="l-Scalar-Plain">}</span>
</pre></div>
</div>
<div class="section" id="top-states">
<h2>Top states</h2>
<p>There is only one thing to do — to add top files and this tree is over.</p>
<p><tt class="docutils literal">salt/top.sls</tt></p>
<div class="highlight"><pre><span class="l-Scalar-Plain">base</span><span class="p-Indicator">:</span>
  <span class="s">&#39;*&#39;</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">user</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">source_code</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">python</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">redis</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">postgresql</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">website.django</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">website.wsgiserver</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">website.webserver</span>
</pre></div>
<p><tt class="docutils literal">pillar/top.sls</tt></p>
<div class="highlight"><pre><span class="l-Scalar-Plain">base</span><span class="p-Indicator">:</span>
  <span class="s">&#39;*&#39;</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">postgresql</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">website</span>
</pre></div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>This article was mostly about states examples.
It's time to test configuration.</p>
<div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd </span>abstract-internal-messaging/vagrant
<span class="gp">$</span> vagrant up
</pre></div>
<p>In order to reach website you can add <tt class="docutils literal">1.2.3.4 <span class="pre">messaging-part-1</span></tt> to
<tt class="docutils literal">/etc/hosts</tt>. Now it should work:</p>
<div class="highlight"><pre><span class="gp">$</span> curl -i messaging-part-1
</pre></div>
<p>Tests should be passed as well:</p>
<div class="highlight"><pre><span class="gp">$</span> vagrant ssh
<span class="gp">$</span> <span class="nb">source</span> /home/jon_snow/venv/bin/activate
<span class="gp">(venv)$</span> <span class="nb">cd</span> /home/jon_snow/abstract-internal-messaging
<span class="gp">(venv)$</span> ./manage.py <span class="nb">test</span>
</pre></div>
</div>
<p class="subheader">Category: <a href="http://marselester.ru/category/infrastructure.html">Infrastructure</a>

    Tagged: 
    <a href="http://marselester.ru/tag/python.html">python </a>
    <a href="http://marselester.ru/tag/django.html">django </a>
    <a href="http://marselester.ru/tag/vagrant.html">vagrant </a>
    <a href="http://marselester.ru/tag/salt.html">salt </a>
    <a href="http://marselester.ru/tag/saltstack.html">saltstack </a>
</p>



<p><a href="http://marselester.ru/developing-django-project-with-saltstack.html#disqus_thread">comments</a></p>            </article>


                <hr  class="gradient"/>


        


            <article>
                <a href="http://marselester.ru/python-developer-at-uploadcare.html"><h3 class="article-title">Python Developer at Uploadcare</h3></a>
<h6 class="subheader" title="2013-07-31T00:00:00">Wed 31 July 2013
</h6>


<p>I started to look for a full-time remote job as a Python Developer after
<a class="reference external" href="http://fangid.com/">FanGid</a> contract has been ended. And I found what
I was looking for -- <a class="reference external" href="https://uploadcare.com">Uploadcare</a>, a cloud-based
file upload SaaS -- <a class="reference external" href="https://github.com/uploadcare?tab=members">great team</a>,
appropriate development process, adherence to quality standards.</p>
<p>I started to work at Uploadcare from tasks ...</p><p class="subheader">Category: <a href="http://marselester.ru/category/portfolio.html">Portfolio</a>

    Tagged: 
    <a href="http://marselester.ru/tag/python.html">python </a>
    <a href="http://marselester.ru/tag/django.html">django </a>
    <a href="http://marselester.ru/tag/tornado.html">tornado </a>
    <a href="http://marselester.ru/tag/flask.html">flask </a>
    <a href="http://marselester.ru/tag/aws.html">aws </a>
</p>



<p><a href="http://marselester.ru/python-developer-at-uploadcare.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.ru/python-developer-at-uploadcare.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.ru/preparation-to-python-interview.html"><h3 class="article-title">Preparation to Python Interview</h3></a>
<h6 class="subheader" title="2012-11-02T00:00:00">Fri 02 November 2012
</h6>


<p>I decided to collect a little more information and experience during
preparation to Python developer interview. These are some information and
links which seemed important to me. Maybe it will be helpful.</p>
<div class="section" id="how-does-it-usually-go">
<h2>How does it usually go?</h2>
<div class="section" id="what-kind-of-projects-did-you-participate-in">
<h3>What kind of projects did you participate in?</h3>
<p>What did you do at ...</p></div></div><p class="subheader">Category: <a href="http://marselester.ru/category/python.html">Python</a>

    Tagged: 
    <a href="http://marselester.ru/tag/python.html">python </a>
    <a href="http://marselester.ru/tag/interview.html">interview </a>
</p>



<p><a href="http://marselester.ru/preparation-to-python-interview.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.ru/preparation-to-python-interview.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.ru/fangid-startup.html"><h3 class="article-title">Стартап fangid.com</h3></a>
<h6 class="subheader" title="2012-10-13T00:00:00">Sat 13 October 2012
</h6>


<p>В середине июля 2012 г. команда <a class="reference external" href="http://fangid.com/">стартапа fangid.com</a>
приступила к воплощению идеи социальной концертной платформы на севере
Таиланда. Я занимался подготовительными работами (соглашениями по разработке,
первоначальной подготовкой репозитория, например, продумыванием структуры,
организацией тестов, разделением настроек), принимал участие в выработке
требований к системе и проектировании архитектуры. При конструировании системы
моими ...</p><p class="subheader">Category: <a href="http://marselester.ru/category/portfolio.html">Portfolio</a>

    Tagged: 
    <a href="http://marselester.ru/tag/python.html">python </a>
    <a href="http://marselester.ru/tag/django.html">django </a>
    <a href="http://marselester.ru/tag/startup.html">startup </a>
    <a href="http://marselester.ru/tag/thailand.html">thailand </a>
</p>



<p><a href="http://marselester.ru/fangid-startup.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.ru/fangid-startup.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.ru/portfolio-2007-2011.html"><h3 class="article-title">Портфолио 2007–2011</h3></a>
<h6 class="subheader" title="2012-10-12T00:00:00">Fri 12 October 2012
</h6>


<p>Не стал перечислять те сайты, которые за давностью лет были переделаны либо
перестали существовать. В основном backend основан на cms myscon, которая была
переписана мною несколько раз.</p>
<div class="section" id="id2">
<h2>2011</h2>
<ul class="simple">
<li>электронный архив ежемесячного литературно-публицистического журнала
«<a class="reference external" href="http://agidel-magazine.ru/">Агидель</a>» на Django. Предполагается, что ресурс будет содержать архив
журналов с 1923 года. Для удобной навигации сделал ...</li></ul></div><p class="subheader">Category: <a href="http://marselester.ru/category/portfolio.html">Portfolio</a>

    Tagged: 
    <a href="http://marselester.ru/tag/php.html">php </a>
    <a href="http://marselester.ru/tag/codeigniter.html">codeigniter </a>
    <a href="http://marselester.ru/tag/cms-myscon.html">cms myscon </a>
    <a href="http://marselester.ru/tag/python.html">python </a>
    <a href="http://marselester.ru/tag/django.html">django </a>
</p>



<p><a href="http://marselester.ru/portfolio-2007-2011.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.ru/portfolio-2007-2011.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.ru/django-todo-testing-during-construction.html"><h3 class="article-title">Django TODO: тестирование во время конструирования</h3></a>
<h6 class="subheader" title="2012-06-29T13:00:00">Fri 29 June 2012
</h6>


<p>Тестирование, выполняемое разработчиками -- один из важнейших элементов полной
стратегии тестирования.</p>
<p>Тестирование может указать только на отдельные дефектные области программы --
оно не сделает программу удобнее в использовании, более быстрой, компактной,
удобочитаемой или расширяемой.</p>
<p>Цель тестирования противоположна целям других этапов разработки. Его целью
является нахождение ошибок. Успешным считается тест, нарушающий работу ПО ...</p><p class="subheader">Category: <a href="http://marselester.ru/category/python.html">Python</a>

    Tagged: 
    <a href="http://marselester.ru/tag/python.html">python </a>
    <a href="http://marselester.ru/tag/django.html">django </a>
    <a href="http://marselester.ru/tag/django-todo.html">django-todo </a>
    <a href="http://marselester.ru/tag/testing.html">testing </a>
</p>



<p><a href="http://marselester.ru/django-todo-testing-during-construction.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.ru/django-todo-testing-during-construction.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.ru/django-todo-system-construction.html"><h3 class="article-title">Django TODO: конструирование системы</h3></a>
<h6 class="subheader" title="2012-06-29T12:00:00">Fri 29 June 2012
</h6>


<p>При работе над проектом конструирование включает другие процессы, в том числе
проектирование. Формальная архитектура дает ответы только на вопросы
системного уровня, при этом значительная часть проектирования может быть
намеренно оставлена на этап конструирования. Проектирование -- это
&quot;постепенный&quot; процесс. Проекты приложений не возникают в умах разработчиков
сразу в готовом виде. Они развиваются ...</p><p class="subheader">Category: <a href="http://marselester.ru/category/python.html">Python</a>

    Tagged: 
    <a href="http://marselester.ru/tag/python.html">python </a>
    <a href="http://marselester.ru/tag/django.html">django </a>
    <a href="http://marselester.ru/tag/django-todo.html">django-todo </a>
    <a href="http://marselester.ru/tag/construction.html">construction </a>
</p>



<p><a href="http://marselester.ru/django-todo-system-construction.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.ru/django-todo-system-construction.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.ru/django-todo-design-architecture.html"><h3 class="article-title">Django TODO: проектирование архитектуры системы</h3></a>
<h6 class="subheader" title="2012-06-29T11:00:00">Fri 29 June 2012
</h6>


<p>Следующим этапом разработки системы является проектирование архитектуры.</p>
<p>Архитектура должна быть продуманным концептуальным целым. Главный тезис самой
популярной книги по разработке ПО &quot;Мифический человеко-месяц&quot; гласит, что
основной проблемой, характерной для крупных систем, является поддержание их
концептуальной целостности. Хорошая архитектура должна соответствовать
проблеме <a class="footnote-reference" href="#mcconnell" id="id1">[1]</a>.</p>
<p>Разделение системы на подсистемы на уровне архитектуры, позволяет ...</p><p class="subheader">Category: <a href="http://marselester.ru/category/python.html">Python</a>

    Tagged: 
    <a href="http://marselester.ru/tag/python.html">python </a>
    <a href="http://marselester.ru/tag/django.html">django </a>
    <a href="http://marselester.ru/tag/django-todo.html">django-todo </a>
    <a href="http://marselester.ru/tag/architecture.html">architecture </a>
</p>



<p><a href="http://marselester.ru/django-todo-design-architecture.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.ru/django-todo-design-architecture.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.ru/django-todo-development-of-system-requirements.html"><h3 class="article-title">Django TODO: выработка требований к системе</h3></a>
<h6 class="subheader" title="2012-06-29T11:00:00">Fri 29 June 2012
</h6>


<p>После прочтения Макконелла захотелось спроецировать его советы на Django.
Для этого я взял за основу разработку системы <a class="reference external" href="https://github.com/marselester/django-todo">Django TODO</a>. Итак, первый этап -- выработка требований к
системе.</p>
<p>Требования подробно описывают, что должна делать система. Внимание к
требованиям помогает свести к минимуму изменения системы после начала
разработки. Явные требования помогают гарантировать, что ...</p><p class="subheader">Category: <a href="http://marselester.ru/category/python.html">Python</a>

    Tagged: 
    <a href="http://marselester.ru/tag/python.html">python </a>
    <a href="http://marselester.ru/tag/django.html">django </a>
    <a href="http://marselester.ru/tag/django-todo.html">django-todo </a>
    <a href="http://marselester.ru/tag/requirements.html">requirements </a>
</p>



<p><a href="http://marselester.ru/django-todo-development-of-system-requirements.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.ru/django-todo-development-of-system-requirements.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.ru/links-to-best-practices-of-python-django.html"><h3 class="article-title">Соглашения по разработке на Python/Django</h3></a>
<h6 class="subheader" title="2012-06-29T00:00:00">Fri 29 June 2012
</h6>


<p>Во время разработки я часто сверяюсь с известными мне соглашениями,
стараюсь следовать рекомендациям. Цитировать их не имеет смысла -- лучше
приведу ссылки.</p>
<p><a class="reference external" href="http://www.python.org/dev/peps/pep-0008/">PEP 8 -- Style Guide for Python Code</a>.</p>
<p><a class="reference external" href="http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html#long-lines-continuations">Code Like a Pythonista: Idiomatic Python</a>.
В нем я нашел ответы на вопросы форматирования длинных строк:</p>
<pre class="literal-block">
expended_time = (self.finish_date() - self.start_date
                 + datetime ...</pre><p class="subheader">Category: <a href="http://marselester.ru/category/python.html">Python</a>

    Tagged: 
    <a href="http://marselester.ru/tag/python.html">python </a>
    <a href="http://marselester.ru/tag/django.html">django </a>
    <a href="http://marselester.ru/tag/best-practices.html">best practices </a>
</p>



<p><a href="http://marselester.ru/links-to-best-practices-of-python-django.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.ru/links-to-best-practices-of-python-django.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.ru/splitting-settings-in-django.html"><h3 class="article-title">Разделение настроек в Django</h3></a>
<h6 class="subheader" title="2012-06-29T00:00:00">Fri 29 June 2012
</h6>


<p>В <a class="reference external" href="https://code.djangoproject.com/wiki/SplitSettings">Django wiki</a> собраны
различные способы разделения настроек. Мне нравится <a class="reference external" href="http://senko.net/en/django-quickstart-skeleton-project/">вариант</a>, описанный в блоге
Senko Rašić:</p>
<pre class="literal-block">
settings/
├── __init__.py
├── base.py
├── development.py
├── local.py
└── production.py
</pre>
<p><tt class="docutils literal">base.py</tt> содержит общие настройки для <tt class="docutils literal">development.py</tt> и
<tt class="docutils literal">production.py</tt>, например:</p>
<div class="highlight"><pre><span class="n">ADMINS</span> <span class="o">=</span> <span class="p">()</span>
<span class="n">MANAGERS</span> <span class="o">=</span> <span class="n">ADMINS</span>

<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s">&#39;Asia/Yekaterinburg&#39;</span>
<span class="c"># ...</span>
</pre></div>
<p><tt class="docutils literal">production.py</tt> содержит настройки для ...</p><p class="subheader">Category: <a href="http://marselester.ru/category/python.html">Python</a>

    Tagged: 
    <a href="http://marselester.ru/tag/python.html">python </a>
    <a href="http://marselester.ru/tag/django.html">django </a>
    <a href="http://marselester.ru/tag/settings.html">settings </a>
</p>



<p><a href="http://marselester.ru/splitting-settings-in-django.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.ru/splitting-settings-in-django.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.ru/short-overview-of-infrastructure-for-developing-reusable-django-apps.html"><h3 class="article-title">Краткий обзор инфраструктуры для разработки reusable Django приложений</h3></a>
<h6 class="subheader" title="2012-06-13T00:00:00">Wed 13 June 2012
</h6>


<p>Начиная впервые разрабатывать веб-приложения на новом фреймворке программист
зачастую сталкивается с некоторыми трудностями. При разработке отчуждаемых
веб-приложений на Django к этим проблемам необходимо отнести организацию
файлов в проекте, обнаружение тестов, вопросы пакетирования приложений и
организации автоматизированного тестирования. В данной статье приведены пути
решения этих проблем.</p>
<p>Важно знать различия между двумя ...</p><p class="subheader">Category: <a href="http://marselester.ru/category/python.html">Python</a>

    Tagged: 
    <a href="http://marselester.ru/tag/python.html">python </a>
    <a href="http://marselester.ru/tag/django.html">django </a>
    <a href="http://marselester.ru/tag/infrastructure.html">infrastructure </a>
</p>



<p><a href="http://marselester.ru/short-overview-of-infrastructure-for-developing-reusable-django-apps.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.ru/short-overview-of-infrastructure-for-developing-reusable-django-apps.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.ru/modeling-single-channel-queue-with-refusals.html"><h3 class="article-title">Моделирование одноканальной СМО с отказами</h3></a>
<h6 class="subheader" title="2009-05-30T00:00:00">Sat 30 May 2009
</h6>


<p>Дана одноканальная система массового обслуживания с отказами. В нее поступают
заявки через промежуток времени <tt class="docutils literal">n</tt>, где <tt class="docutils literal">n</tt> – случайная величина,
подчиненная равномерному закону распределения. Время обслуживания заявки
системой <tt class="docutils literal">m</tt> также является случайной величиной с показательным законом
распределения. Если к моменту прихода заявки канал занят, заявка покидает
систему необслуженной.</p>
<p>Изначально код был ...</p><p class="subheader">Category: <a href="http://marselester.ru/category/misc.html">Misc</a>

    Tagged: 
    <a href="http://marselester.ru/tag/python.html">python </a>
    <a href="http://marselester.ru/tag/modeling.html">modeling </a>
    <a href="http://marselester.ru/tag/single-channel-queue.html">single-channel queue </a>
</p>



<p><a href="http://marselester.ru/modeling-single-channel-queue-with-refusals.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.ru/modeling-single-channel-queue-with-refusals.html">Read More</a>
                <hr  class="gradient"/>
            </article>

            <!-- /#posts-list -->

    </div>
    <!-- End Main Content -->

    <!-- Sidebar -->
    <aside class="large-3 columns">
        <h5 class="sidebar-title">Site</h5>
        <ul class="side-nav">
            <li><a href="http://marselester.ru/archives.html">Archives</a>
            <li><a href="http://marselester.ru/tags.html">Tags</a>
        </ul>

		
        <h5 class="sidebar-title">Categories</h5>
        <ul class="side-nav">
            <li><a href="http://marselester.ru/category/infrastructure.html">Infrastructure</a></li>
            <li><a href="http://marselester.ru/category/misc.html">Misc</a></li>
            <li><a href="http://marselester.ru/category/portfolio.html">Portfolio</a></li>
            <li><a href="http://marselester.ru/category/python.html">Python</a></li>
   
        </ul>

		
        <h5 class="sidebar-title">Social</h5>
        <ul class="side-nav">
            <li><a href="https://github.com/marselester">GitHub</a></li>
            <li><a href="http://www.linkedin.com/in/marselester">LinkedIn</a></li>
            <li><a href="http://instagram.com/marselester">Instagram</a></li>
            <li><a href="http://twitter.com/marselester">Twitter</a></li>
            <li><a href="http://www.facebook.com/marselester">Facebook</a></li>
            <li><a href="http://mmavletkulov.moikrug.ru/">Мой Круг</a></li>
        </ul>

    </aside> <!-- End Sidebar -->

</div> <!-- End Main Content and Sidebar -->


<!-- Footer -->
<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
                <p>marselester's blog by Marsel Mavletkulov</p>
            </div>
            </div>
    </div>
</footer>