<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width" />

    <title>marselester's blog</title>

    <link rel="stylesheet" href="http://marselester.com/theme/css/normalize.css" />
    <link rel="stylesheet" href="http://marselester.com/theme/css/foundation.min.css" />
    <link rel="stylesheet" href="http://marselester.com/theme/css/style.css" />
    <link rel="stylesheet" href="http://marselester.com/theme/css/pygments.css" />	
    <script src="http://marselester.com/theme/js/custom.modernizr.js"></script>
</head>

<body>

<!-- Nav Bar -->
<nav>
<div class="top-bar">
<div class="row">
    <div class="large-9 large-centered columns">
	    <h1><a href="http://marselester.com">marselester's blog</a></h1>
    </div>
</div>
</div>

<!-- Show menu items and pages -->
<div class="row">
<div class="large-9 columns">
    <ul class="button-group navigation">
    <li><a href="http://marselester.com/cv/" class="button secondary small">CV</a></li>

            <li><a href="http://marselester.com/pages/about.html" class="button secondary small">About</a></li>
    </ul>
</div>
</div>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->
<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns">
        
        

            <article>
                <a href="http://marselester.com/prometheus-on-kubernetes.html"><h3 class="article-title">Prometheus on Kubernetes</h3></a>
<h6 class="subheader" title="2016-11-13T00:00:00+07:00">Sun 13 November 2016
</h6>


<p><a class="reference external" href="https://prometheus.io/">Prometheus</a> is a monitoring toolkit.
Let's set it up on Kubernetes and test how it works by scraping HTTP request metrics
from <a class="reference external" href="https://github.com/marselester/prometheus-on-kubernetes">hello web application</a>
which also runs in the same cluster.</p>
<p>First of all, we need Kubernetes cluster running. It's easy to bootstrap one via <a class="reference external" href="https://console.cloud.google.com">Google Container Engine</a>.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> gcloud container clusters create my-k8
</pre></div>
<p>The command above might complain that zone is not currently set.
Choose the one you like and try to create a cluster again.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> gcloud compute zones list
<span class="gp">$</span> gcloud config <span class="nb">set</span> compute/zone asia-east1-b
</pre></div>
<p>You should now have a Kubernetes cluster.
If there are any issues, check out <a class="reference external" href="https://www.udacity.com/course/scalable-microservices-with-kubernetes--ud615">Udacity course</a> which helped me run Kubernetes in GKE.</p>
<div class="section" id="first-start">
<h2>First Start</h2>
<p>Prometheus is available as Docker image and can be run locally quickly.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> docker run -p 9090:9090 prom/prometheus:v1.2.1
</pre></div>
<p>When a container is started, the Prometheus expression browser should be accessible on <cite>http://localhost:9090</cite>.
Now let's achieve the same results with Kubernetes.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> kubectl run prometheus-deployment --image<span class="o">=</span>prom/prometheus:v1.2.1 --port<span class="o">=</span>9090
</pre></div>
<p>The command above created <a class="reference external" href="http://kubernetes.io/docs/user-guide/deployments/">Kubernetes Deployment</a>
that runs <cite>prometheus</cite> Docker image.</p>
<p>By default deployed applications are visible only inside the Kubernetes cluster.
To see whether Prometheus started up, we can run a proxy between terminal and Kubernetes cluster.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> kubectl proxy
<span class="go">Starting to serve on 127.0.0.1:8001</span>
</pre></div>
<p>In another cloud shell, we can call Kubernetes API.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> kubectl get pods
<span class="go">NAME                                     READY     STATUS    RESTARTS   AGE</span>
<span class="go">prometheus-deployment-2234044252-of29y   1/1       Running   0          8m</span>

<span class="gp">$</span> curl http://127.0.0.1:8001/api/v1/proxy/namespaces/default/pods/prometheus-deployment-2234044252-of29y:9090/metrics
</pre></div>
<p>Another option is to run a port forwarding:</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> kubectl port-forward prometheus-deployment-2234044252-of29y 8080:9090
<span class="gp">$</span> curl http://127.0.0.1:8080/metrics
</pre></div>
<p>Check Prometheus container logs:</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> kubectl logs -f po/prometheus-deployment-2234044252-of29y
<span class="go">time=&quot;2016-10-29T05:02:38Z&quot; level=info msg=&quot;Starting prometheus (version=1.2.1, branch=master, revision=dd66f2e94b2b662804b9aa1b6a50587b990ba8b7)&quot; source=&quot;main.go:75&quot;</span>
</pre></div>
<p>And finally we can run a shell inside the Pod's container and have a look at Prometheus config file.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> kubectl <span class="nb">exec</span> prometheus-deployment-2234044252-of29y -it /bin/sh
<span class="go">root$ cat /etc/prometheus/prometheus.yml</span>
</pre></div>
<p>Its advisable to describe Deployments in configuration files,
so we can have a better visibility and version control over our cluster.
The following Deployment manifest is similar to what we achieved with <cite>kubectl run</cite> command.</p>
<div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus-deployment</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">replicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span> <span class="c1"># tells deployment to run 1 pod matching the template below</span>
  <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span> <span class="c1"># crete pods using pod definition in this template</span>
    <span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span> <span class="c1"># these key value pairs will be attached to pods</span>
        <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus-server</span>
    <span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus</span>
          <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prom/prometheus:v1.2.1</span>
          <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">containerPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">9090</span> <span class="c1"># port we open in the container</span>
</pre></div>
<p>Let's delete <cite>prometheus-deployment</cite> we created via <cite>kubectl run</cite> command</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> kubectl delete deployment prometheus-deployment
</pre></div>
<p>and re-create the Deployment from a file (it is available in git repository):</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> git clone https://github.com/marselester/prometheus-on-kubernetes.git
<span class="gp">$</span> <span class="nb">cd</span> ./prometheus-on-kubernetes/
<span class="gp">$</span> kubectl create -f kube/prometheus/deployment-v1.yml
<span class="gp">$</span> kubectl get deployments
<span class="go">NAME                    DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span>
<span class="go">prometheus-deployment   1         1         1            0           40s</span>
</pre></div>
</div>
<div class="section" id="prometheus-service">
<h2>Prometheus Service</h2>
<p>We have a Prometheus Pod running.
Now we need <a class="reference external" href="http://kubernetes.io/docs/user-guide/services/">Kubernetes Service</a> to let external clients access it.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> kubectl expose deployment prometheus-deployment --type<span class="o">=</span>NodePort --name<span class="o">=</span>prometheus-service
</pre></div>
<p>The assigned port can be found in <cite>NodePort</cite> output of Service description:</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> kubectl describe service prometheus-service
<span class="gp">#</span> ...
<span class="go">NodePort:               &lt;unset&gt; 32514/TCP</span>
<span class="gp">#</span> ...
</pre></div>
<p>We have exposed the Service on an external port <cite>32514</cite> on all nodes in our cluster.
Now create a firewall rule to allow external traffic.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> gcloud compute firewall-rules create prometheus-nodeport --allow<span class="o">=</span>tcp:32514
</pre></div>
<p>Let's use one of the external IPs from our Kubernetes cluster instances to see Prometheus expression browser.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> gcloud compute instances list
</pre></div>
<p>You should be able to access Prometheus on <cite>http://&lt;EXTERNAL_IP&gt;:32514</cite>.
Let's delete the Service and create it via Service config file.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> kubectl delete service prometheus-service
<span class="gp">$</span> kubectl create -f kube/prometheus/service-v1.yml
</pre></div>
<p>Since the Prometheus Pod exposes <cite>9090</cite> port and has <cite>app: prometheus-server</cite> label,
our config should be as following:</p>
<div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus-service</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span> <span class="c1"># exposes any pods with the following labels as a service</span>
    <span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus-server</span>
  <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">NodePort</span>
  <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span> <span class="c1"># this Service&#39;s port (cluster-internal IP clusterIP)</span>
      <span class="l l-Scalar l-Scalar-Plain">targetPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">9090</span> <span class="c1"># pods expose this port</span>
      <span class="c1"># Kubernetes master will allocate a port from a flag-configured range (default: 30000-32767),</span>
      <span class="c1"># or we can set a specific port number (in our case).</span>
      <span class="c1"># Each node will proxy 32514 port (the same port number on every node) into this service.</span>
      <span class="c1"># Note that this Service will be visible as both NodeIP:nodePort and clusterIp:port</span>
      <span class="l l-Scalar l-Scalar-Plain">nodePort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">32514</span>
</pre></div>
</div>
<div class="section" id="prometheus-config">
<h2>Prometheus Config</h2>
<p>So far we've been using the default Prometheus config which is part of a Docker image.
For sure we will need to update it so Prometheus can collect metrics from our example app.
Let's take the default config as a starting point and store it in
<a class="reference external" href="http://kubernetes.io/docs/user-guide/configmap/">Kubernetes ConfigMap</a>.
The config can be copied from the running container or from the git repository.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> kubectl <span class="nb">exec</span> prometheus-deployment-2234044252-of29y -it cat /etc/prometheus/prometheus.yml
</pre></div>
<p>Next we need to create a ConfigMap entry for the <cite>prometheus.yml</cite> file:</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> kubectl create configmap prometheus-server-conf --from-file<span class="o">=</span>kube/prometheus/config-v1.yml
</pre></div>
<p>Now let's mount <cite>prometheus-server-conf</cite> ConfigMap volume to our Prometheus Pod</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> kubectl apply -f kube/prometheus/deployment-v2.yaml
</pre></div>
<p>and store metrics in emptyDir volume, so we don't lose them when a container in the Pod crashes.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> kubectl apply -f kube/prometheus/deployment-v3.yml
</pre></div>
</div>
<div class="section" id="sending-app-metrics">
<h2>Sending App Metrics</h2>
<p>We have a Prometheus running in Kubernetes but we have no application to monitor.
I wrote <a class="reference external" href="https://github.com/marselester/prometheus-on-kubernetes/blob/master/hello-app/v1/main.go">hello-app/v1</a> web app that exposes <cite>/hello</cite> HTTP endpoint.</p>
<p><a class="reference external" href="https://youtu.be/HkEZ1LJ7kzQ?list=PLDWZ5uzn69eyh791ZTkEA9OaTxVpGY8_g">Björn Rabenstein in his talk</a>
explains how to instrument your code to expose metrics to Prometheus.
Our application is not forced to use Prometheus client to expose metrics.
We can create <cite>/metrics</cite> HTTP endpoint manually in the following text format:</p>
<div class="highlight"><pre><span></span># HELP http_requests_total Number of HTTP requests.
# TYPE http_requests_total counter
http_requests_total{code=&quot;200&quot;,method=&quot;get&quot;} 2384
</pre></div>
<p>But it's much easier to use a library
(see <a class="reference external" href="https://github.com/marselester/prometheus-on-kubernetes/blob/master/hello-app/v2/main.go">hello-app/v2</a>).</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="s">&quot;github.com/prometheus/client_golang/prometheus/promhttp&quot;</span>
<span class="c1">// ...</span>
<span class="nx">http</span><span class="p">.</span><span class="nx">Handle</span><span class="p">(</span><span class="s">&quot;/metrics&quot;</span><span class="p">,</span> <span class="nx">promhttp</span><span class="p">.</span><span class="nx">Handler</span><span class="p">())</span>
</pre></div>
<p>Now the app has <cite>/metrics</cite> endpoint with Go runtime metrics (number of goroutines, GC statistics).</p>
<p>Our app exposes an important endpoint <cite>/hello</cite>.</p>
<div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">helloHandler</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">status</span> <span class="o">:=</span> <span class="nx">doSomeWork</span><span class="p">()</span>
    <span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">status</span><span class="p">)</span>
    <span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;Hello, World!\n&quot;</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
<p>Let's instrument <cite>helloHandler()</cite> to count HTTP requests and their durations.
First, we need to define metrics.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="s">&quot;github.com/prometheus/client_golang/prometheus&quot;</span>

<span class="kd">var</span> <span class="p">(</span>
    <span class="c1">// How often our /hello request durations fall into one of the defined buckets.</span>
    <span class="c1">// We can use default buckets or set ones we are interested in.</span>
    <span class="nx">duration</span> <span class="p">=</span> <span class="nx">prometheus</span><span class="p">.</span><span class="nx">NewHistogram</span><span class="p">(</span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">HistogramOpts</span><span class="p">{</span>
        <span class="nx">Name</span><span class="p">:</span>    <span class="s">&quot;hello_request_duration_seconds&quot;</span><span class="p">,</span>
        <span class="nx">Help</span><span class="p">:</span>    <span class="s">&quot;Histogram of the /hello request duration.&quot;</span><span class="p">,</span>
        <span class="nx">Buckets</span><span class="p">:</span> <span class="p">[]</span><span class="kt">float64</span><span class="p">{</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">},</span>
    <span class="p">})</span>
    <span class="c1">// Counter vector to which we can attach labels. That creates many key-value</span>
    <span class="c1">// label combinations. So in our case we count requests by status code separetly.</span>
    <span class="nx">counter</span> <span class="p">=</span> <span class="nx">prometheus</span><span class="p">.</span><span class="nx">NewCounterVec</span><span class="p">(</span>
        <span class="nx">prometheus</span><span class="p">.</span><span class="nx">CounterOpts</span><span class="p">{</span>
            <span class="nx">Name</span><span class="p">:</span> <span class="s">&quot;hello_requests_total&quot;</span><span class="p">,</span>
            <span class="nx">Help</span><span class="p">:</span> <span class="s">&quot;Total number of /hello requests.&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;status&quot;</span><span class="p">},</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1">// init registers Prometheus metrics.</span>
<span class="kd">func</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">prometheus</span><span class="p">.</span><span class="nx">MustRegister</span><span class="p">(</span><span class="nx">duration</span><span class="p">)</span>
    <span class="nx">prometheus</span><span class="p">.</span><span class="nx">MustRegister</span><span class="p">(</span><span class="nx">counter</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p>Second, measure a request duration in seconds and increase the counter in the <cite>helloHandler()</cite> function.</p>
<div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">helloHandler</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">status</span> <span class="kt">int</span>

    <span class="k">defer</span> <span class="kd">func</span><span class="p">(</span><span class="nx">begun</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">duration</span><span class="p">.</span><span class="nx">Observe</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">begun</span><span class="p">).</span><span class="nx">Seconds</span><span class="p">())</span>

        <span class="c1">// hello_requests_total{status=&quot;200&quot;} 2385</span>
        <span class="nx">counter</span><span class="p">.</span><span class="nx">With</span><span class="p">(</span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">Labels</span><span class="p">{</span>
            <span class="s">&quot;status&quot;</span><span class="p">:</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprint</span><span class="p">(</span><span class="nx">status</span><span class="p">),</span>
        <span class="p">}).</span><span class="nx">Inc</span><span class="p">()</span>
    <span class="p">}(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">())</span>

    <span class="nx">status</span> <span class="p">=</span> <span class="nx">doSomeWork</span><span class="p">()</span>
    <span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">status</span><span class="p">)</span>
    <span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;Hello, World!\n&quot;</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
<p><a class="reference external" href="https://github.com/marselester/prometheus-on-kubernetes/blob/master/hello-app/v3/main.go">hello-app/v3</a>
is used in further examples.</p>
</div>
<div class="section" id="hello-app-demo">
<h2>Hello App Demo</h2>
<p>Next step is to run the web app in Kubernetes.
A Docker image of the <cite>hello-app/v3</cite> is available on Docker Hub.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> kubectl apply -f kube/hello/deployment-v1.yml
<span class="gp">$</span> kubectl port-forward hello-deployment-1471727270-eaknp 8000:8000
<span class="gp">$</span> curl localhost:8000/hello
<span class="go">Hello, World!</span>
<span class="gp">$</span> curl localhost:8000/metrics
<span class="go">...</span>
<span class="gp">#</span> HELP hello_request_duration_seconds Histogram of the /hello request duration.
<span class="gp">#</span> TYPE hello_request_duration_seconds histogram
<span class="go">hello_request_duration_seconds_bucket{le=&quot;0.01&quot;} 0</span>
<span class="go">hello_request_duration_seconds_bucket{le=&quot;0.025&quot;} 0</span>
<span class="go">hello_request_duration_seconds_bucket{le=&quot;0.05&quot;} 0</span>
<span class="go">hello_request_duration_seconds_bucket{le=&quot;0.1&quot;} 1</span>
<span class="go">hello_request_duration_seconds_bucket{le=&quot;0.25&quot;} 1</span>
<span class="go">hello_request_duration_seconds_bucket{le=&quot;0.5&quot;} 1</span>
<span class="go">hello_request_duration_seconds_bucket{le=&quot;1&quot;} 1</span>
<span class="go">hello_request_duration_seconds_bucket{le=&quot;2.5&quot;} 1</span>
<span class="go">hello_request_duration_seconds_bucket{le=&quot;5&quot;} 1</span>
<span class="go">hello_request_duration_seconds_bucket{le=&quot;10&quot;} 1</span>
<span class="go">hello_request_duration_seconds_bucket{le=&quot;+Inf&quot;} 1</span>
<span class="go">hello_request_duration_seconds_sum 0.083953974</span>
<span class="go">hello_request_duration_seconds_count 1</span>
<span class="gp">#</span> HELP hello_requests_total Total number of /hello requests.
<span class="gp">#</span> TYPE hello_requests_total counter
<span class="go">hello_requests_total{status=&quot;500&quot;} 1</span>
</pre></div>
<p>The Service creation is similar to what we have already done before.
We use <cite>32515</cite> NodePort here.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> kubectl apply -f kube/hello/service-v1.yml
<span class="gp">$</span> gcloud compute firewall-rules create hello-nodeport --allow<span class="o">=</span>tcp:32515
</pre></div>
<p>Now it is possible to see the app's metrics from Internet.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> curl http://&lt;EXTERNAL_IP&gt;:32515/metrics
</pre></div>
</div>
<div class="section" id="hello-prometheus">
<h2>Hello Prometheus</h2>
<p>Since the web app is run on Kubernetes, we can configure Prometheus
to scrape metrics from <cite>/metrics</cite> HTTP endpoint of hello-app Pods.</p>
<div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">global</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">scrape_interval</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">5s</span>
  <span class="l l-Scalar l-Scalar-Plain">evaluation_interval</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">5s</span>

<span class="l l-Scalar l-Scalar-Plain">scrape_configs</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">job_name</span><span class="p p-Indicator">:</span> <span class="s">&#39;prometheus&#39;</span>
    <span class="l l-Scalar l-Scalar-Plain">static_configs</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">targets</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;localhost:9090&#39;</span><span class="p p-Indicator">]</span>

  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">job_name</span><span class="p p-Indicator">:</span> <span class="s">&#39;hello&#39;</span>
    <span class="c1"># The information to access the Kubernetes API to discover targets.</span>
    <span class="l l-Scalar l-Scalar-Plain">kubernetes_sd_configs</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">api_servers</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&#39;https://kubernetes.default.svc&#39;</span>
        <span class="c1"># Prometheus assumes it is being run inside a Kubernetes pod.</span>
        <span class="l l-Scalar l-Scalar-Plain">in_cluster</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class="c1"># Only pods should be discovered.</span>
        <span class="l l-Scalar l-Scalar-Plain">role</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">pod</span>
    <span class="c1"># Prometheus collects metrics from pods with &quot;app: hello-server&quot; label.</span>
    <span class="c1"># Prometheus gets &#39;hello_requests_total{status=&quot;500&quot;} 1&#39;</span>
    <span class="c1"># from hello:8000/metrics and adds &quot;job&quot; and &quot;instance&quot; labels, so it becomes</span>
    <span class="c1"># &#39;hello_requests_total{instance=&quot;10.16.0.10:8000&quot;,job=&quot;hello&quot;,status=&quot;500&quot;} 1&#39;.</span>
    <span class="l l-Scalar l-Scalar-Plain">relabel_configs</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">source_labels</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">__meta_kubernetes_pod_label_app</span><span class="p p-Indicator">]</span>
        <span class="l l-Scalar l-Scalar-Plain">regex</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">hello-server</span>
        <span class="l l-Scalar l-Scalar-Plain">action</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">keep</span>
</pre></div>
<p>Update a ConfigMap of Prometheus config and re-create a Prometheus Pod so it picks up changes.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> kubectl create configmap prometheus-server-conf <span class="se">\</span>
<span class="go">    --from-file=kube/prometheus/config-v2.yaml \</span>
<span class="go">    -o yaml \</span>
<span class="go">    --dry-run | kubectl replace -f -</span>
</pre></div>
<p>Finally, the app's metrics should show up in Prometheus expression browser <cite>http://&lt;EXTERNAL_IP&gt;:32514</cite>.</p>
<p>You can try to query <cite>hello_requests_total</cite> which shows how many requests we've served since the beginning.
Let's see how many requests we've served in last 5 minutes normalised per second (QPS)
with <cite>rate(hello_requests_total[5m])</cite> query.</p>
<p>Here I gave an example of how to run Prometheus in Kubernetes cluster
and collect metrics from a simple web app.
However recently I have encountered CoreOS <a class="reference external" href="https://github.com/coreos/kube-prometheus">kube-prometheus</a>
which makes it easier. Have a look at <a class="reference external" href="https://coreos.com/blog/the-prometheus-operator.html">The Prometheus Operator: Managed Prometheus setups for Kubernetes</a> for more details.</p>
</div>
<p class="subheader">Category: <a href="http://marselester.com/category/infrastructure.html">Infrastructure</a>

    Tagged: 
    <a href="http://marselester.com/tag/prometheus.html">prometheus </a>
    <a href="http://marselester.com/tag/kubernetes.html">kubernetes </a>
    <a href="http://marselester.com/tag/monitoring.html">monitoring </a>
    <a href="http://marselester.com/tag/golang.html">golang </a>
    <a href="http://marselester.com/tag/google-container-engine.html">Google Container Engine </a>
</p>



<p><a href="http://marselester.com/prometheus-on-kubernetes.html#disqus_thread">comments</a></p>            </article>


                <hr  class="gradient"/>


        


            <article>
                <a href="http://marselester.com/drf-pagination.html"><h3 class="article-title">Django REST framework: pagination on PostgreSQL triggers</h3></a>
<h6 class="subheader" title="2016-04-02T00:00:00+07:00">Sat 02 April 2016
</h6>


<p>Django and Django REST Framework use SQL COUNT in pagination.
As your database grows SQL COUNT becomes too slow. Fortunately the frameworks
are well designed and allow to customize a way items are count.
Let me illustrate that on a typical &quot;books&quot; example.</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField ...</span></pre></div><p class="subheader">Category: <a href="http://marselester.com/category/python.html">Python</a>

    Tagged: 
    <a href="http://marselester.com/tag/python.html">python </a>
    <a href="http://marselester.com/tag/django.html">django </a>
    <a href="http://marselester.com/tag/postgresql.html">postgresql </a>
    <a href="http://marselester.com/tag/django-rest-framework.html">django rest framework </a>
    <a href="http://marselester.com/tag/pagination.html">pagination </a>
</p>



<p><a href="http://marselester.com/drf-pagination.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.com/drf-pagination.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.com/api-based-on-flask.html"><h3 class="article-title">API based on Flask</h3></a>
<h6 class="subheader" title="2013-12-09T00:00:00+07:00">Mon 09 December 2013
</h6>


<p>Here I want to consider implementation of API best practices which
usually don't follow Fielding's REST strictly. <a class="reference external" href="https://github.com/marselester/api-example-based-on-flask">Example Flask project</a>
is on GitHub.</p>
<div class="section" id="api-versioning">
<h2>API Versioning</h2>
<p>Interfaces are changed hence versioning is mandatory in order to not annoy
your users. You might need to add new resource or field ...</p></div><p class="subheader">Category: <a href="http://marselester.com/category/python.html">Python</a>

    Tagged: 
    <a href="http://marselester.com/tag/python.html">python </a>
    <a href="http://marselester.com/tag/flask.html">flask </a>
    <a href="http://marselester.com/tag/api.html">api </a>
</p>



<p><a href="http://marselester.com/api-based-on-flask.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.com/api-based-on-flask.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.com/saltstack-slides.html"><h3 class="article-title">Slides about SaltStack</h3></a>
<h6 class="subheader" title="2013-12-03T00:00:00+07:00">Tue 03 December 2013
</h6>


<p><strong>Update</strong> I gave a talk with <a class="reference external" href="https://twitter.com/shr">Simon Robson</a> at <a class="reference external" href="https://twitter.com/barcampcm">Beercamp</a> in Chiang Mai,
Thailand on 12 Dec 2013. We compared Salt and <a class="reference external" href="http://slid.es/simonrobson/ansible">Ansible</a>.
Here are my slides.</p>
<iframe src="http://slid.es/marselester/saltstack/embed" width="576" height="420" scrolling="no" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe><p class="subheader">Category: <a href="http://marselester.com/category/infrastructure.html">Infrastructure</a>

    Tagged: 
    <a href="http://marselester.com/tag/salt.html">salt </a>
    <a href="http://marselester.com/tag/saltstack.html">saltstack </a>
    <a href="http://marselester.com/tag/slides.html">slides </a>
    <a href="http://marselester.com/tag/talk.html">talk </a>
</p>



<p><a href="http://marselester.com/saltstack-slides.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.com/saltstack-slides.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.com/developing-and-deploying-django-project-with-saltstack.html"><h3 class="article-title">Developing &amp; Deploying Django project with SaltStack</h3></a>
<h6 class="subheader" title="2013-11-28T00:00:00+07:00">Thu 28 November 2013
</h6>


<p>Eventually you will need to deploy project,
but deployment was not considered in the <a class="reference external" href="http://marselester.com/developing-django-project-with-saltstack.html">previous post</a>. Let's find it out.</p>
<p>Server configuration is different from local, thus environments will be needed
(at least production <strong>prod</strong> and development <strong>dev</strong>). Salt uses <strong>base</strong>
environment by default.</p>
<p>Environments are set in <tt class="docutils literal">minion ...</tt></p><p class="subheader">Category: <a href="http://marselester.com/category/infrastructure.html">Infrastructure</a>

    Tagged: 
    <a href="http://marselester.com/tag/python.html">python </a>
    <a href="http://marselester.com/tag/django.html">django </a>
    <a href="http://marselester.com/tag/vagrant.html">vagrant </a>
    <a href="http://marselester.com/tag/salt.html">salt </a>
    <a href="http://marselester.com/tag/saltstack.html">saltstack </a>
</p>



<p><a href="http://marselester.com/developing-and-deploying-django-project-with-saltstack.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.com/developing-and-deploying-django-project-with-saltstack.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.com/developing-django-project-with-saltstack.html"><h3 class="article-title">Developing Django project with SaltStack</h3></a>
<h6 class="subheader" title="2013-11-09T00:00:00+07:00">Sat 09 November 2013
</h6>


<p>Let's use <a class="reference external" href="https://github.com/marselester/abstract-internal-messaging">Messaging System</a> as an example of Django project. I want it to
run in VirtualBox which is managed by Vagrant. Infrastructure management
is provided by SaltStack.</p>
<p>I advise you to create separate folder for repositories (currently there
is only one) of project and clone <a class="reference external" href="https://github.com/marselester/abstract-internal-messaging">Messaging System</a> there ...</p><p class="subheader">Category: <a href="http://marselester.com/category/infrastructure.html">Infrastructure</a>

    Tagged: 
    <a href="http://marselester.com/tag/python.html">python </a>
    <a href="http://marselester.com/tag/django.html">django </a>
    <a href="http://marselester.com/tag/vagrant.html">vagrant </a>
    <a href="http://marselester.com/tag/salt.html">salt </a>
    <a href="http://marselester.com/tag/saltstack.html">saltstack </a>
</p>



<p><a href="http://marselester.com/developing-django-project-with-saltstack.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.com/developing-django-project-with-saltstack.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.com/python-developer-at-uploadcare.html"><h3 class="article-title">Python Developer at Uploadcare</h3></a>
<h6 class="subheader" title="2013-07-31T00:00:00+07:00">Wed 31 July 2013
</h6>


<p>I started to look for a full-time remote job as a Python Developer after
<a class="reference external" href="http://fangid.com/">FanGid</a> contract has been ended. And I found what
I was looking for -- <a class="reference external" href="https://uploadcare.com">Uploadcare</a>, a cloud-based
file upload SaaS -- <a class="reference external" href="https://github.com/uploadcare?tab=members">great team</a>,
appropriate development process, adherence to quality standards.</p>
<p>I started to work at Uploadcare from tasks ...</p><p class="subheader">Category: <a href="http://marselester.com/category/portfolio.html">Portfolio</a>

    Tagged: 
    <a href="http://marselester.com/tag/python.html">python </a>
    <a href="http://marselester.com/tag/django.html">django </a>
    <a href="http://marselester.com/tag/tornado.html">tornado </a>
    <a href="http://marselester.com/tag/flask.html">flask </a>
    <a href="http://marselester.com/tag/aws.html">aws </a>
</p>



<p><a href="http://marselester.com/python-developer-at-uploadcare.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.com/python-developer-at-uploadcare.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.com/preparation-to-python-interview.html"><h3 class="article-title">Preparation to Python Interview</h3></a>
<h6 class="subheader" title="2012-11-02T00:00:00+07:00">Fri 02 November 2012
</h6>


<p>I decided to collect a little more information and experience during
preparation to Python developer interview. These are some information and
links which seemed important to me. Maybe it will be helpful.</p>
<div class="section" id="how-does-it-usually-go">
<h2>How does it usually go?</h2>
<div class="section" id="what-kind-of-projects-did-you-participate-in">
<h3>What kind of projects did you participate in?</h3>
<p>What did you do at ...</p></div></div><p class="subheader">Category: <a href="http://marselester.com/category/python.html">Python</a>

    Tagged: 
    <a href="http://marselester.com/tag/python.html">python </a>
    <a href="http://marselester.com/tag/interview.html">interview </a>
</p>



<p><a href="http://marselester.com/preparation-to-python-interview.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.com/preparation-to-python-interview.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.com/fangid-startup.html"><h3 class="article-title">Стартап fangid.com</h3></a>
<h6 class="subheader" title="2012-10-13T00:00:00+07:00">Sat 13 October 2012
</h6>


<p>В середине июля 2012 г. команда <a class="reference external" href="http://fangid.com/">стартапа fangid.com</a>
приступила к воплощению идеи социальной концертной платформы на севере
Таиланда. Я занимался подготовительными работами (соглашениями по разработке,
первоначальной подготовкой репозитория, например, продумыванием структуры,
организацией тестов, разделением настроек), принимал участие в выработке
требований к системе и проектировании архитектуры. При конструировании системы
моими ...</p><p class="subheader">Category: <a href="http://marselester.com/category/portfolio.html">Portfolio</a>

    Tagged: 
    <a href="http://marselester.com/tag/python.html">python </a>
    <a href="http://marselester.com/tag/django.html">django </a>
    <a href="http://marselester.com/tag/startup.html">startup </a>
    <a href="http://marselester.com/tag/thailand.html">thailand </a>
</p>



<p><a href="http://marselester.com/fangid-startup.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.com/fangid-startup.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.com/portfolio-2007-2011.html"><h3 class="article-title">Портфолио 2007–2011</h3></a>
<h6 class="subheader" title="2012-10-12T00:00:00+07:00">Fri 12 October 2012
</h6>


<p>Не стал перечислять те сайты, которые за давностью лет были переделаны либо
перестали существовать. В основном backend основан на cms myscon, которая была
переписана мною несколько раз.</p>
<div class="section" id="id2">
<h2>2011</h2>
<ul class="simple">
<li>электронный архив ежемесячного литературно-публицистического журнала
«<a class="reference external" href="http://agidel-magazine.ru/">Агидель</a>» на Django. Предполагается, что ресурс будет содержать архив
журналов с 1923 года. Для удобной навигации сделал ...</li></ul></div><p class="subheader">Category: <a href="http://marselester.com/category/portfolio.html">Portfolio</a>

    Tagged: 
    <a href="http://marselester.com/tag/php.html">php </a>
    <a href="http://marselester.com/tag/codeigniter.html">codeigniter </a>
    <a href="http://marselester.com/tag/cms-myscon.html">cms myscon </a>
    <a href="http://marselester.com/tag/python.html">python </a>
    <a href="http://marselester.com/tag/django.html">django </a>
</p>



<p><a href="http://marselester.com/portfolio-2007-2011.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.com/portfolio-2007-2011.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.com/django-todo-testing-during-construction.html"><h3 class="article-title">Django TODO: тестирование во время конструирования</h3></a>
<h6 class="subheader" title="2012-06-29T13:00:00+07:00">Fri 29 June 2012
</h6>


<p>Тестирование, выполняемое разработчиками -- один из важнейших элементов полной
стратегии тестирования.</p>
<p>Тестирование может указать только на отдельные дефектные области программы --
оно не сделает программу удобнее в использовании, более быстрой, компактной,
удобочитаемой или расширяемой.</p>
<p>Цель тестирования противоположна целям других этапов разработки. Его целью
является нахождение ошибок. Успешным считается тест, нарушающий работу ПО ...</p><p class="subheader">Category: <a href="http://marselester.com/category/python.html">Python</a>

    Tagged: 
    <a href="http://marselester.com/tag/python.html">python </a>
    <a href="http://marselester.com/tag/django.html">django </a>
    <a href="http://marselester.com/tag/django-todo.html">django-todo </a>
    <a href="http://marselester.com/tag/testing.html">testing </a>
</p>



<p><a href="http://marselester.com/django-todo-testing-during-construction.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.com/django-todo-testing-during-construction.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.com/django-todo-system-construction.html"><h3 class="article-title">Django TODO: конструирование системы</h3></a>
<h6 class="subheader" title="2012-06-29T12:00:00+07:00">Fri 29 June 2012
</h6>


<p>При работе над проектом конструирование включает другие процессы, в том числе
проектирование. Формальная архитектура дает ответы только на вопросы
системного уровня, при этом значительная часть проектирования может быть
намеренно оставлена на этап конструирования. Проектирование -- это
&quot;постепенный&quot; процесс. Проекты приложений не возникают в умах разработчиков
сразу в готовом виде. Они развиваются ...</p><p class="subheader">Category: <a href="http://marselester.com/category/python.html">Python</a>

    Tagged: 
    <a href="http://marselester.com/tag/python.html">python </a>
    <a href="http://marselester.com/tag/django.html">django </a>
    <a href="http://marselester.com/tag/django-todo.html">django-todo </a>
    <a href="http://marselester.com/tag/construction.html">construction </a>
</p>



<p><a href="http://marselester.com/django-todo-system-construction.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.com/django-todo-system-construction.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.com/django-todo-design-architecture.html"><h3 class="article-title">Django TODO: проектирование архитектуры системы</h3></a>
<h6 class="subheader" title="2012-06-29T11:00:00+07:00">Fri 29 June 2012
</h6>


<p>Следующим этапом разработки системы является проектирование архитектуры.</p>
<p>Архитектура должна быть продуманным концептуальным целым. Главный тезис самой
популярной книги по разработке ПО &quot;Мифический человеко-месяц&quot; гласит, что
основной проблемой, характерной для крупных систем, является поддержание их
концептуальной целостности. Хорошая архитектура должна соответствовать
проблеме <a class="footnote-reference" href="#mcconnell" id="id1">[1]</a>.</p>
<p>Разделение системы на подсистемы на уровне архитектуры, позволяет ...</p><p class="subheader">Category: <a href="http://marselester.com/category/python.html">Python</a>

    Tagged: 
    <a href="http://marselester.com/tag/python.html">python </a>
    <a href="http://marselester.com/tag/django.html">django </a>
    <a href="http://marselester.com/tag/django-todo.html">django-todo </a>
    <a href="http://marselester.com/tag/architecture.html">architecture </a>
</p>



<p><a href="http://marselester.com/django-todo-design-architecture.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.com/django-todo-design-architecture.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.com/django-todo-development-of-system-requirements.html"><h3 class="article-title">Django TODO: выработка требований к системе</h3></a>
<h6 class="subheader" title="2012-06-29T11:00:00+07:00">Fri 29 June 2012
</h6>


<p>После прочтения Макконелла захотелось спроецировать его советы на Django.
Для этого я взял за основу разработку системы <a class="reference external" href="https://github.com/marselester/django-todo">Django TODO</a>. Итак, первый этап -- выработка требований к
системе.</p>
<p>Требования подробно описывают, что должна делать система. Внимание к
требованиям помогает свести к минимуму изменения системы после начала
разработки. Явные требования помогают гарантировать, что ...</p><p class="subheader">Category: <a href="http://marselester.com/category/python.html">Python</a>

    Tagged: 
    <a href="http://marselester.com/tag/python.html">python </a>
    <a href="http://marselester.com/tag/django.html">django </a>
    <a href="http://marselester.com/tag/django-todo.html">django-todo </a>
    <a href="http://marselester.com/tag/requirements.html">requirements </a>
</p>



<p><a href="http://marselester.com/django-todo-development-of-system-requirements.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.com/django-todo-development-of-system-requirements.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.com/links-to-best-practices-of-python-django.html"><h3 class="article-title">Соглашения по разработке на Python/Django</h3></a>
<h6 class="subheader" title="2012-06-29T00:00:00+07:00">Fri 29 June 2012
</h6>


<p>Во время разработки я часто сверяюсь с известными мне соглашениями,
стараюсь следовать рекомендациям. Цитировать их не имеет смысла -- лучше
приведу ссылки.</p>
<p><a class="reference external" href="http://www.python.org/dev/peps/pep-0008/">PEP 8 -- Style Guide for Python Code</a>.</p>
<p><a class="reference external" href="http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html#long-lines-continuations">Code Like a Pythonista: Idiomatic Python</a>.
В нем я нашел ответы на вопросы форматирования длинных строк:</p>
<pre class="literal-block">
expended_time = (self.finish_date() - self.start_date
                 + datetime ...</pre><p class="subheader">Category: <a href="http://marselester.com/category/python.html">Python</a>

    Tagged: 
    <a href="http://marselester.com/tag/python.html">python </a>
    <a href="http://marselester.com/tag/django.html">django </a>
    <a href="http://marselester.com/tag/best-practices.html">best practices </a>
</p>



<p><a href="http://marselester.com/links-to-best-practices-of-python-django.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.com/links-to-best-practices-of-python-django.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.com/splitting-settings-in-django.html"><h3 class="article-title">Разделение настроек в Django</h3></a>
<h6 class="subheader" title="2012-06-29T00:00:00+07:00">Fri 29 June 2012
</h6>


<p>В <a class="reference external" href="https://code.djangoproject.com/wiki/SplitSettings">Django wiki</a> собраны
различные способы разделения настроек. Мне нравится <a class="reference external" href="http://senko.net/en/django-quickstart-skeleton-project/">вариант</a>, описанный в блоге
Senko Rašić:</p>
<pre class="literal-block">
settings/
├── __init__.py
├── base.py
├── development.py
├── local.py
└── production.py
</pre>
<p><tt class="docutils literal">base.py</tt> содержит общие настройки для <tt class="docutils literal">development.py</tt> и
<tt class="docutils literal">production.py</tt>, например:</p>
<div class="highlight"><pre><span></span><span class="n">ADMINS</span> <span class="o">=</span> <span class="p">()</span>
<span class="n">MANAGERS</span> <span class="o">=</span> <span class="n">ADMINS</span>

<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s1">&#39;Asia/Yekaterinburg&#39;</span>
<span class="c1"># ...</span>
</pre></div>
<p><tt class="docutils literal">production.py</tt> содержит настройки для ...</p><p class="subheader">Category: <a href="http://marselester.com/category/python.html">Python</a>

    Tagged: 
    <a href="http://marselester.com/tag/python.html">python </a>
    <a href="http://marselester.com/tag/django.html">django </a>
    <a href="http://marselester.com/tag/settings.html">settings </a>
</p>



<p><a href="http://marselester.com/splitting-settings-in-django.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.com/splitting-settings-in-django.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.com/short-overview-of-infrastructure-for-developing-reusable-django-apps.html"><h3 class="article-title">Краткий обзор инфраструктуры для разработки reusable Django приложений</h3></a>
<h6 class="subheader" title="2012-06-13T00:00:00+07:00">Wed 13 June 2012
</h6>


<p>Начиная впервые разрабатывать веб-приложения на новом фреймворке программист
зачастую сталкивается с некоторыми трудностями. При разработке отчуждаемых
веб-приложений на Django к этим проблемам необходимо отнести организацию
файлов в проекте, обнаружение тестов, вопросы пакетирования приложений и
организации автоматизированного тестирования. В данной статье приведены пути
решения этих проблем.</p>
<p>Важно знать различия между двумя ...</p><p class="subheader">Category: <a href="http://marselester.com/category/python.html">Python</a>

    Tagged: 
    <a href="http://marselester.com/tag/python.html">python </a>
    <a href="http://marselester.com/tag/django.html">django </a>
    <a href="http://marselester.com/tag/infrastructure.html">infrastructure </a>
</p>



<p><a href="http://marselester.com/short-overview-of-infrastructure-for-developing-reusable-django-apps.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.com/short-overview-of-infrastructure-for-developing-reusable-django-apps.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.com/computing-methods-of-one-dimensional-optimization.html"><h3 class="article-title">Вычислительные методы одномерной оптимизации</h3></a>
<h6 class="subheader" title="2010-10-06T00:00:00+07:00">Wed 06 October 2010
</h6>


<p>На третьем курсе по предмету методы оптимизации делали лабораторную работу на
тему «Вычислительные методы одномерной оптимизации».
Задача заключалась в поиске безусловного минимума функции
<tt class="docutils literal">f(x) = pow(x, 3) – x + pow(e, <span class="pre">-x)</span></tt> на начальном интервале <tt class="docutils literal">[0, 1]</tt>
с точностью <tt class="docutils literal">0.00001</tt>.</p>
<p>Вычисления производились через:</p>
<ul class="simple">
<li>пассивный метод;</li>
<li>равномерные блочные методы;</li>
<li>метод ...</li></ul><p class="subheader">Category: <a href="http://marselester.com/category/misc.html">Misc</a>

    Tagged: 
    <a href="http://marselester.com/tag/php.html">php </a>
    <a href="http://marselester.com/tag/mathematical-optimization.html">mathematical optimization </a>
</p>



<p><a href="http://marselester.com/computing-methods-of-one-dimensional-optimization.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.com/computing-methods-of-one-dimensional-optimization.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.com/definition-of-pressing-of-a-combination-of-keys-by-means-BIOS-on-the-assembler.html"><h3 class="article-title">Определение нажатия комбинации клавиш средствами BIOS на ассемблере</h3></a>
<h6 class="subheader" title="2009-12-03T00:00:00+07:00">Thu 03 December 2009
</h6>


<p>По учебе понадобилось написать программу на ассемблере, которая должна
распознать нажатие «горячей» комбинации клавиш <tt class="docutils literal">LeftCtrl+RightShift+F3</tt> и
реагировать на него звуковым сигналом. Информации/примеров по этой теме
маловато, по этому решил опубликовать свою программку.</p>
<div class="highlight"><pre><span></span><span class="nf">masm</span>
<span class="nf">.model</span> <span class="nv">small</span>
<span class="nf">.stack</span> <span class="mi">256</span>
<span class="nf">.data</span>
    <span class="nf">Msg_about</span> <span class="nv">db</span> <span class="s">&#39;Распознать нажатие «горячей» комбинации клавиш&#39;</span><span class="p">,</span> <span class="mh">0Ah</span><span class="p">,</span> <span class="mh">0Dh ...</span></pre></div><p class="subheader">Category: <a href="http://marselester.com/category/misc.html">Misc</a>

    Tagged: 
    <a href="http://marselester.com/tag/assembler.html">assembler </a>
</p>



<p><a href="http://marselester.com/definition-of-pressing-of-a-combination-of-keys-by-means-BIOS-on-the-assembler.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.com/definition-of-pressing-of-a-combination-of-keys-by-means-BIOS-on-the-assembler.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://marselester.com/modeling-single-channel-queue-with-refusals.html"><h3 class="article-title">Моделирование одноканальной СМО с отказами</h3></a>
<h6 class="subheader" title="2009-05-30T00:00:00+07:00">Sat 30 May 2009
</h6>


<p>Дана одноканальная система массового обслуживания с отказами. В нее поступают
заявки через промежуток времени <tt class="docutils literal">n</tt>, где <tt class="docutils literal">n</tt> – случайная величина,
подчиненная равномерному закону распределения. Время обслуживания заявки
системой <tt class="docutils literal">m</tt> также является случайной величиной с показательным законом
распределения. Если к моменту прихода заявки канал занят, заявка покидает
систему необслуженной.</p>
<p>Изначально код был ...</p><p class="subheader">Category: <a href="http://marselester.com/category/misc.html">Misc</a>

    Tagged: 
    <a href="http://marselester.com/tag/python.html">python </a>
    <a href="http://marselester.com/tag/modeling.html">modeling </a>
    <a href="http://marselester.com/tag/single-channel-queue.html">single-channel queue </a>
</p>



<p><a href="http://marselester.com/modeling-single-channel-queue-with-refusals.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://marselester.com/modeling-single-channel-queue-with-refusals.html">Read More</a>
                <hr  class="gradient"/>
            </article>

            <!-- /#posts-list -->

    </div>
    <!-- End Main Content -->

    <!-- Sidebar -->
    <aside class="large-3 columns">
        <h5 class="sidebar-title">Site</h5>
        <ul class="side-nav">
            <li><a href="http://marselester.com/archives.html">Archives</a>
            <li><a href="http://marselester.com/tags.html">Tags</a>
        </ul>

		
        <h5 class="sidebar-title">Categories</h5>
        <ul class="side-nav">
            <li><a href="http://marselester.com/category/infrastructure.html">Infrastructure</a></li>
            <li><a href="http://marselester.com/category/misc.html">Misc</a></li>
            <li><a href="http://marselester.com/category/portfolio.html">Portfolio</a></li>
            <li><a href="http://marselester.com/category/python.html">Python</a></li>
   
        </ul>

		
        <h5 class="sidebar-title">Social</h5>
        <ul class="side-nav">
            <li><a href="https://github.com/marselester">GitHub</a></li>
            <li><a href="http://www.linkedin.com/in/marselester">LinkedIn</a></li>
            <li><a href="http://instagram.com/marselester">Instagram</a></li>
            <li><a href="https://medium.com/@marselester/">Medium</a></li>
            <li><a href="http://twitter.com/marselester">Twitter</a></li>
            <li><a href="http://www.facebook.com/marselester">Facebook</a></li>
        </ul>

    </aside> <!-- End Sidebar -->

</div> <!-- End Main Content and Sidebar -->


<!-- Footer -->
<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
                <p>marselester's blog by Marsel Mavletkulov</p>
            </div>
            </div>
    </div>
</footer>