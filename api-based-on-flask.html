<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width" />

    <title>API based on Flask</title>

    <link rel="stylesheet" href="http://marselester.ru/theme/css/normalize.css" />
    <link rel="stylesheet" href="http://marselester.ru/theme/css/foundation.min.css" />
    <link rel="stylesheet" href="http://marselester.ru/theme/css/style.css" />
    <link rel="stylesheet" href="http://marselester.ru/theme/css/pygments.css" />	
    <script src="http://marselester.ru/theme/js/custom.modernizr.js"></script>
</head>

<body>

<!-- Nav Bar -->
<nav>
<div class="top-bar">
<div class="row">
    <div class="large-9 large-centered columns">
	    <h1><a href="http://marselester.ru">marselester's blog</a></h1>
    </div>
</div>
</div>

<!-- Show menu items and pages -->
<div class="row">
<div class="large-9 columns">
    <ul class="button-group navigation">
    <li><a href="http://marselester.ru/cv/" class="button secondary small">CV</a></li>

            <li><a href="http://marselester.ru/pages/about.html" class="button secondary small">About</a></li>
    </ul>
</div>
</div>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->
<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns">
<article>
    <header>
        <h3 class="article-title"><a href="http://marselester.ru/api-based-on-flask.html" rel="bookmark"
        title="Permalink to API based on Flask">API based on Flask</a></h3>
<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="marselester">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
    </header>

<h6 class="subheader" title="2013-12-09T00:00:00">Mon 09 December 2013
</h6>


    <p>Here I want to consider implementation of API best practices which
usually don't follow Fielding's REST strictly. <a class="reference external" href="https://github.com/marselester/api-example-based-on-flask">Example Flask project</a>
is on GitHub.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">Post will be updated.</p>
</div>
<div class="section" id="api-versioning">
<h2>API Versioning</h2>
<p>Interfaces are changed hence versioning is mandatory in order to not annoy
your users. You might need to add new resource or field to particular resource.
You write code, tests and update documentation. Users are happy.
It's possible that you have to rename or delete field of some resource.
This case is harder and you might make the easiest decision — spawn
a lot of <tt class="docutils literal">if</tt> statements and write more tests consequently.
Code base maintaining is getting worse.</p>
<p>I think it's better to make API versions isolated.
It will keep things simple and tests as well. You may even want to change
framework if legacy API implementation is not good enough.
For example, you have two WSGI applications. Each application implements
certain API version, e.g, <strong>messaging_api_v1</strong>, <strong>messaging_api_v2</strong>.
In order to hide versioning information from applications, e.g., URL prefix,
you can dispatch requests by Werkzeug's <tt class="docutils literal">DispatcherMiddleware</tt>.</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">werkzeug.wsgi</span> <span class="kn">import</span> <span class="n">DispatcherMiddleware</span>
<span class="kn">from</span> <span class="nn">werkzeug.exceptions</span> <span class="kn">import</span> <span class="n">NotFound</span>

<span class="kn">import</span> <span class="nn">messaging_api_v1</span>
<span class="kn">import</span> <span class="nn">messaging_api_v2</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">DispatcherMiddleware</span><span class="p">(</span><span class="n">NotFound</span><span class="p">(),</span> <span class="p">{</span>
    <span class="s">&#39;/v1&#39;</span><span class="p">:</span> <span class="n">messaging_api_v1</span><span class="o">.</span><span class="n">app</span><span class="p">,</span>
    <span class="s">&#39;/v2&#39;</span><span class="p">:</span> <span class="n">messaging_api_v2</span><span class="o">.</span><span class="n">app</span><span class="p">,</span>
<span class="p">})</span>
</pre></div>
<p>Dispatcher in work:</p>
<div class="highlight"><pre><span class="gp">$</span> gunicorn messaging_api:app
</pre></div>
<p>Let's request the same API resource from different WSGI applications:</p>
<div class="highlight"><pre><span class="gp">$</span> curl http://127.0.0.1:8000/v1/messages/1
<span class="go">{</span>
<span class="go">  &quot;content&quot;: &quot;hi world from V1&quot;</span>
<span class="go">}</span>
<span class="gp">$</span> curl http://127.0.0.1:8000/v2/messages/1
<span class="go">{</span>
<span class="go">  &quot;content&quot;: &quot;hi world from V2&quot;</span>
<span class="go">}</span>
</pre></div>
</div>

<p class="subheader">Category: <a href="http://marselester.ru/category/python.html">Python</a>

    Tagged: 
    <a href="http://marselester.ru/tag/python.html">python </a>
    <a href="http://marselester.ru/tag/flask.html">flask </a>
    <a href="http://marselester.ru/tag/api.html">api </a>
</p>




	<h4>Comments</h4>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'marselester'
        var disqus_identifier = "api-based-on-flask.html";
        var disqus_url = "http://marselester.ru/api-based-on-flask.html";

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</article>
    </div>
    <!-- End Main Content -->

    <!-- Sidebar -->
    <aside class="large-3 columns">
        <h5 class="sidebar-title">Site</h5>
        <ul class="side-nav">
            <li><a href="http://marselester.ru/archives.html">Archives</a>
            <li><a href="http://marselester.ru/tags.html">Tags</a>
        </ul>

		
        <h5 class="sidebar-title">Categories</h5>
        <ul class="side-nav">
            <li><a href="http://marselester.ru/category/infrastructure.html">Infrastructure</a></li>
            <li><a href="http://marselester.ru/category/misc.html">Misc</a></li>
            <li><a href="http://marselester.ru/category/portfolio.html">Portfolio</a></li>
            <li><a href="http://marselester.ru/category/python.html">Python</a></li>
   
        </ul>

		
        <h5 class="sidebar-title">Social</h5>
        <ul class="side-nav">
            <li><a href="https://github.com/marselester">GitHub</a></li>
            <li><a href="http://www.linkedin.com/in/marselester">LinkedIn</a></li>
            <li><a href="http://instagram.com/marselester">Instagram</a></li>
            <li><a href="http://twitter.com/marselester">Twitter</a></li>
            <li><a href="http://www.facebook.com/marselester">Facebook</a></li>
            <li><a href="http://mmavletkulov.moikrug.ru/">Мой Круг</a></li>
        </ul>

    </aside> <!-- End Sidebar -->

</div> <!-- End Main Content and Sidebar -->


<!-- Footer -->
<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
                <p>marselester's blog by Marsel Mavletkulov</p>
            </div>
            </div>
    </div>
</footer>