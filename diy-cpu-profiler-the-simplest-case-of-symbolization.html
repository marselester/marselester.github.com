<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width" />

    <title>DIY CPU profiler: the simplest case of symbolization</title>

    <link rel="stylesheet" href="https://marselester.com/theme/css/normalize.css" />
    <link rel="stylesheet" href="https://marselester.com/theme/css/foundation.min.css" />
    <link rel="stylesheet" href="https://marselester.com/theme/css/style.css" />
    <link rel="stylesheet" href="https://marselester.com/theme/css/pygments.css" />	
    <script src="https://marselester.com/theme/js/custom.modernizr.js"></script>

    <!-- So Firefox can bookmark->"abo this site" -->
        <link href="feeds/all.atom.xml" rel="alternate" title="marselester's blog" type="application/atom+xml">

</head>

<body>

<!-- Nav Bar -->
<nav>
<div class="top-bar">
<div class="row">
    <div class="large-9 large-centered columns">
	    <h1><a href="https://marselester.com">marselester's blog</a></h1>
    </div>
</div>
</div>

<!-- Show menu items and pages -->
<div class="row">
<div class="large-9 columns">
    <ul class="button-group navigation">

            <li><a href="https://marselester.com/pages/about.html" class="button secondary small">About</a></li>
    </ul>
</div>
</div>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->
<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns">
<article>
    <header>
        <h3 class="article-title"><a href="https://marselester.com/diy-cpu-profiler-the-simplest-case-of-symbolization.html" rel="bookmark"
        title="Permalink to DIY CPU profiler: the simplest case of symbolization">DIY CPU profiler: the simplest case of symbolization</a></h3>
<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="marselester">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
    </header>

<h6 class="subheader" title="2023-03-23T00:00:00+07:00">Thu 23 March 2023
</h6>


    <p>In the <a href="https://marselester.com/diy-cpu-profiler-from-bpf-maps-to-pprof.html">BPF maps to pprof</a> post
we managed to collect CPU samples and store them in pprof format.
Here I would like to explore the simplest case of symbolization
and put shared libraries aside.</p>
<p>Symbolization is resolving sampled memory addresses to function names (symbols).
In our case, simply searching for an address in <code>.symtab</code> ELF section.</p>
<h2>What's in the profile?</h2>
<p>Let's profile a C program that ensures we'll get lots of CPU samples.
It computes Fibonacci numbers naively (without caching),
so <code>fibNaive</code> function should dominate the profile.</p>
<div class="highlight"><pre><span></span><code><span class="kt">long</span><span class="w"> </span><span class="nf">fibNaive</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">fibNaive</span><span class="p">(</span><span class="n">n</span><span class="mi">-2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fibNaive</span><span class="p">(</span><span class="n">n</span><span class="mi">-1</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<details>


<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="c1">// fibNaive calculates a Fibonacci number n,</span>
<span class="c1">// e.g., when n=7, the result is 13: 1 1 2 3 5 8 13.</span>
<span class="c1">//</span>
<span class="c1">// The running time complexity is exponential 2**n,</span>
<span class="c1">// the space complexity is n because</span>
<span class="c1">// when we descend the binary tree recursively,</span>
<span class="c1">// we use number of stacks equal to its height which is n</span>
<span class="c1">// (the stack frames n=7-&gt;5-&gt;3-&gt;1).</span>
<span class="kt">long</span><span class="w"> </span><span class="nf">fibNaive</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">fibNaive</span><span class="p">(</span><span class="n">n</span><span class="mi">-2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fibNaive</span><span class="p">(</span><span class="n">n</span><span class="mi">-1</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Calculating 50th Fibonacci number will keep CPU busy</span>
<span class="w">    </span><span class="c1">// and give us time to run a CPU profiler.</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fibNaive</span><span class="p">(</span><span class="n">n</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Fibonacci number %li: %li</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



</details>

<div class="highlight"><pre><span></span><code><span class="go">﹩ # For reference, I used gcc 11.3.0 and Ubuntu 22.04.</span>
<span class="go">﹩ gcc -Og -fno-pie -no-pie -fcf-protection=none -o fib main.c</span>
<span class="go">﹩ ./fib &amp;</span>
<span class="go">﹩ sudo go run ./cmd/profiler3 -pid=$(pidof fib)</span>
<span class="go">/proc/14548/maps</span>
<span class="go">start=0x401000 limit=0x402000 offset=0x1000 /vagrant/diy-parca-agent/fib</span>
<span class="go">start=0x7f3cd28ac000 limit=0x7f3cd2a41000 offset=0x28000 /usr/lib/x86_64-linux-gnu/libc.so.6</span>
<span class="go">start=0x7f3cd2ab6000 limit=0x7f3cd2ae0000 offset=0x2000 /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2</span>
<span class="go">start=0x7ffc69d62000 limit=0x7ffc69d64000 offset=0x0 [vdso]</span>
<span class="go">start=0xffffffffff600000 limit=0xffffffffff601000 offset=0x0 [vsyscall]</span>

<span class="go">Waiting for stack traces for 10s...</span>
</code></pre></div>

<p>After ten seconds the profiler will terminate leaving us with <code>cpu.pprof</code> file.
Let's inspect it with
<a href="https://github.com/DataDog/go-profiler-notes/blob/main/pprof.md#using-protoc">protoc</a>.</p>
<div class="highlight"><pre><span></span><code><span class="go">﹩ git clone https://github.com/google/pprof.git</span>
<span class="go">﹩ sudo snap install protobuf --classic</span>
<span class="go">﹩ zcat cpu.pprof | \</span>
<span class="go">    protoc --decode perftools.profiles.Profile ./pprof/proto/profile.proto</span>

<span class="go">...</span>
<span class="go">sample {</span>
<span class="go">  location_id: 10</span>
<span class="go">  value: 138</span>
<span class="go">}</span>
<span class="go">...</span>
<span class="go">mapping {</span>
<span class="go">  id: 1</span>
<span class="go">  memory_start: 4198400</span>
<span class="go">  memory_limit: 4202496</span>
<span class="go">  file_offset: 4096</span>
<span class="go">  filename: 3</span>
<span class="go">}</span>
<span class="go">...</span>
<span class="go">location {</span>
<span class="go">  id: 10</span>
<span class="go">  mapping_id: 1</span>
<span class="go">  address: 4198694</span>
<span class="go">}</span>
<span class="go">...</span>
<span class="go">string_table: &quot;&quot;</span>
<span class="go">string_table: &quot;samples&quot;</span>
<span class="go">string_table: &quot;count&quot;</span>
<span class="go">string_table: &quot;/vagrant/diy-parca-agent/fib&quot;</span>
<span class="go">string_table: &quot;/usr/lib/x86_64-linux-gnu/libc.so.6&quot;</span>
<span class="go">string_table: &quot;/usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2&quot;</span>
<span class="go">string_table: &quot;[vdso]&quot;</span>
<span class="go">string_table: &quot;[vsyscall]&quot;</span>
</code></pre></div>

<details>


<div class="highlight"><pre><span></span><code><span class="n">sample_type</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">unit</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">27</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">286</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">111</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">79</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">29</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">138</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">36</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">34</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">22</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">37</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">105</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">sample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">location_id</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="w"></span>
<span class="w">  </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="mi">54</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">mapping</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">memory_start</span><span class="p">:</span><span class="w"> </span><span class="mi">4198400</span><span class="w"></span>
<span class="w">  </span><span class="n">memory_limit</span><span class="p">:</span><span class="w"> </span><span class="mi">4202496</span><span class="w"></span>
<span class="w">  </span><span class="n">file_offset</span><span class="p">:</span><span class="w"> </span><span class="mi">4096</span><span class="w"></span>
<span class="w">  </span><span class="n">filename</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">mapping</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">  </span><span class="n">memory_start</span><span class="p">:</span><span class="w"> </span><span class="mi">139899207073792</span><span class="w"></span>
<span class="w">  </span><span class="n">memory_limit</span><span class="p">:</span><span class="w"> </span><span class="mi">139899208732672</span><span class="w"></span>
<span class="w">  </span><span class="n">file_offset</span><span class="p">:</span><span class="w"> </span><span class="mi">163840</span><span class="w"></span>
<span class="w">  </span><span class="n">filename</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">mapping</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">  </span><span class="n">memory_start</span><span class="p">:</span><span class="w"> </span><span class="mi">139899209211904</span><span class="w"></span>
<span class="w">  </span><span class="n">memory_limit</span><span class="p">:</span><span class="w"> </span><span class="mi">139899209383936</span><span class="w"></span>
<span class="w">  </span><span class="n">file_offset</span><span class="p">:</span><span class="w"> </span><span class="mi">8192</span><span class="w"></span>
<span class="w">  </span><span class="n">filename</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">mapping</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="w">  </span><span class="n">memory_start</span><span class="p">:</span><span class="w"> </span><span class="mi">140722084126720</span><span class="w"></span>
<span class="w">  </span><span class="n">memory_limit</span><span class="p">:</span><span class="w"> </span><span class="mi">140722084134912</span><span class="w"></span>
<span class="w">  </span><span class="n">filename</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">mapping</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="n">memory_start</span><span class="p">:</span><span class="w"> </span><span class="mi">18446744073699065856</span><span class="w"></span>
<span class="w">  </span><span class="n">memory_limit</span><span class="p">:</span><span class="w"> </span><span class="mi">18446744073699069952</span><span class="w"></span>
<span class="w">  </span><span class="n">filename</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">location</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">mapping_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="mi">4198715</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">location</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">  </span><span class="n">mapping_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="mi">4198705</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">location</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">  </span><span class="n">mapping_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="mi">4198700</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">location</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="w">  </span><span class="n">mapping_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="mi">4198724</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">location</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="n">mapping_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="mi">4198706</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">location</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="w"></span>
<span class="w">  </span><span class="n">mapping_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="mi">4198708</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">location</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="w"></span>
<span class="w">  </span><span class="n">mapping_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="mi">4198727</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">location</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="w">  </span><span class="n">mapping_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="mi">4198736</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">location</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="n">mapping_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="mi">4198745</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">location</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="w">  </span><span class="n">mapping_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="mi">4198694</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">location</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span><span class="w"></span>
<span class="w">  </span><span class="n">mapping_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="mi">4198712</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">location</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="w"></span>
<span class="w">  </span><span class="n">mapping_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="mi">4198707</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">location</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="n">mapping_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="mi">4198739</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">location</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="w"></span>
<span class="w">  </span><span class="n">mapping_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="mi">4198743</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">location</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="w"></span>
<span class="w">  </span><span class="n">mapping_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="mi">4198744</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">location</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="w"></span>
<span class="w">  </span><span class="n">mapping_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="mi">4198719</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">string_table</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"></span>
<span class="n">string_table</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;samples&quot;</span><span class="w"></span>
<span class="n">string_table</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;count&quot;</span><span class="w"></span>
<span class="n">string_table</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/vagrant/diy-parca-agent/fib&quot;</span><span class="w"></span>
<span class="n">string_table</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/usr/lib/x86_64-linux-gnu/libc.so.6&quot;</span><span class="w"></span>
<span class="n">string_table</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2&quot;</span><span class="w"></span>
<span class="n">string_table</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;[vdso]&quot;</span><span class="w"></span>
<span class="n">string_table</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;[vsyscall]&quot;</span><span class="w"></span>
<span class="n">string_table</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cpu&quot;</span><span class="w"></span>
<span class="n">string_table</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;nanoseconds&quot;</span><span class="w"></span>
<span class="n">time_nanos</span><span class="p">:</span><span class="w"> </span><span class="mi">1679419143530427477</span><span class="w"></span>
<span class="n">duration_nanos</span><span class="p">:</span><span class="w"> </span><span class="mi">10000000000</span><span class="w"></span>
<span class="n">period_type</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="w">  </span><span class="n">unit</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">period</span><span class="p">:</span><span class="w"> </span><span class="mi">10000000</span><span class="w"></span>
</code></pre></div>



</details>

<p>The example above shows a pprof sample that tells us
that some function (its memory <code>address: 4198694</code>) has been seen 138 times in stack traces.
That function is located in the mapping id 1 according to location id 10,
somewhere between <code>memory_start: 4198400</code> and <code>memory_limit: 4202496</code> addresses.
The mapping points to <code>file_offset: 4096</code> within some file whose path is defined by <code>filename: 3</code>.
I assume it's the third value in the pprof string table counting from zero:
<code>string_table: "/vagrant/diy-parca-agent/fib"</code>.</p>
<p>What does it all mean?
If we recall from <a href="https://marselester.com/linux-process.html">Linux process</a> post,
Linux organizes the virtual memory of a process as a collection of areas (segments)
where an area is a chunk of related virtual pages.
An area can be associated (mapped) with a contiguous chunk of a file,
in this case it is <code>fib</code> executable object file starting at file offset 4096.
Let's look at the file's segments and find the one mentioned in the sample.</p>
<div class="highlight"><pre><span></span><code><span class="go">﹩ readelf --segments --wide fib</span>
</code></pre></div>

<details>


<div class="highlight"><pre><span></span><code><span class="go">Elf file type is EXEC (Executable file)</span>
<span class="go">Entry point 0x401040</span>
<span class="go">There are 13 program headers, starting at offset 64</span>

<span class="go">Program Headers:</span>
<span class="go">  Type           Offset   VirtAddr           PhysAddr           FileSiz  MemSiz   Flg Align</span>
<span class="go">  PHDR           0x000040 0x0000000000400040 0x0000000000400040 0x0002d8 0x0002d8 R   0x8</span>
<span class="go">  INTERP         0x000318 0x0000000000400318 0x0000000000400318 0x00001c 0x00001c R   0x1</span>
<span class="go">      [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2]</span>
<span class="go">  LOAD           0x000000 0x0000000000400000 0x0000000000400000 0x0004f0 0x0004f0 R   0x1000</span>
<span class="go">  LOAD           0x001000 0x0000000000401000 0x0000000000401000 0x00019d 0x00019d R E 0x1000</span>
<span class="go">  LOAD           0x002000 0x0000000000402000 0x0000000000402000 0x000104 0x000104 R   0x1000</span>
<span class="go">  LOAD           0x002e10 0x0000000000403e10 0x0000000000403e10 0x000220 0x000228 RW  0x1000</span>
<span class="go">  DYNAMIC        0x002e20 0x0000000000403e20 0x0000000000403e20 0x0001d0 0x0001d0 RW  0x8</span>
<span class="go">  NOTE           0x000338 0x0000000000400338 0x0000000000400338 0x000020 0x000020 R   0x8</span>
<span class="go">  NOTE           0x000358 0x0000000000400358 0x0000000000400358 0x000044 0x000044 R   0x4</span>
<span class="go">  GNU_PROPERTY   0x000338 0x0000000000400338 0x0000000000400338 0x000020 0x000020 R   0x8</span>
<span class="go">  GNU_EH_FRAME   0x002020 0x0000000000402020 0x0000000000402020 0x000034 0x000034 R   0x4</span>
<span class="go">  GNU_STACK      0x000000 0x0000000000000000 0x0000000000000000 0x000000 0x000000 RW  0x10</span>
<span class="go">  GNU_RELRO      0x002e10 0x0000000000403e10 0x0000000000403e10 0x0001f0 0x0001f0 R   0x1</span>

<span class="go"> Section to Segment mapping:</span>
<span class="go">  Segment Sections...</span>
<span class="go">   00</span>
<span class="go">   01     .interp</span>
<span class="go">   02     .interp .note.gnu.property .note.gnu.build-id .note.ABI-tag .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt</span>
<span class="go">   03     .init .plt .text .fini</span>
<span class="go">   04     .rodata .eh_frame_hdr .eh_frame</span>
<span class="go">   05     .init_array .fini_array .dynamic .got .got.plt .data .bss</span>
<span class="go">   06     .dynamic</span>
<span class="go">   07     .note.gnu.property</span>
<span class="go">   08     .note.gnu.build-id .note.ABI-tag</span>
<span class="go">   09     .note.gnu.property</span>
<span class="go">   10     .eh_frame_hdr</span>
<span class="go">   11</span>
<span class="go">   12     .init_array .fini_array .dynamic .got</span>
</code></pre></div>



</details>

<div class="highlight"><pre><span></span><code><span class="go">Program Headers:</span>
<span class="go">  Type           Offset   VirtAddr           PhysAddr           FileSiz  MemSiz   Flg Align</span>
<span class="go">  ...</span>
<span class="go">  LOAD           0x001000 0x0000000000401000 0x0000000000401000 0x00019d 0x00019d R E 0x1000</span>
<span class="go">  ...</span>

<span class="go"> Section to Segment mapping:</span>
<span class="go">  Segment Sections...</span>
<span class="go">   ...</span>
<span class="go">   03     .init .plt .text .fini</span>
</code></pre></div>

<p>As we can see the ELF program header describes
<code>Flg=R E</code> readable and executable segment
loaded from <code>Offset=0x001000</code> (that's hex of <code>file_offset: 4096</code>) within the file
into memory starting at <code>0x0000000000401000</code> virtual address (that's hex of <code>memory_start: 4198400</code>).
According to <code>FileSiz=0x00019d</code> only 413 bytes are loaded from the file.
Given the alignment requirement <code>Align=0x1000</code>,
the memory area ends at <code>0x0000000000402000</code> virtual address (that's hex of <code>memory_limit: 4202496</code>).
So the area consists of a single page, i.e., 4096 bytes = memory_limit - memory_start.</p>
<p>Here is how a process's virtual address space looks
when the executable file is mapped.</p>
<div class="highlight"><pre><span></span><code><span class="go">Executable object file        Virtual address space</span>
<span class="go"> _______                       _______</span>
<span class="go">|       | 0x3def              |       | N</span>
<span class="go">|       |                     |       |</span>
<span class="go">| ...   | 0x2000              | ...   | 0x402000</span>
<span class="go">|-------| -----------&gt; vm_end |-------|</span>
<span class="go">| .fini | 0x1190              | .fini | 0x401190</span>
<span class="go">| .text | 0x1040              | .text | 0x401040</span>
<span class="go">| .plt  | 0x1020              | .plt  | 0x401020</span>
<span class="go">| .init | 0x1000              | .init | 0x401000</span>
<span class="go">|-------| ---------&gt; vm_start |-------|</span>
<span class="go">| ...   |                     | ...   |</span>
<span class="go">|_______| 0                   |_______| 0</span>
</code></pre></div>

<p>We can also see which ELF sections are placed within the segment: <code>.init .plt .text .fini</code>.
Our function in question should be somewhere in <code>.text</code> section,
because it's where machine code of the compiled program lives.</p>
<div class="highlight"><pre><span></span><code><span class="go">﹩ readelf --sections --wide fib</span>
</code></pre></div>

<details>


<div class="highlight"><pre><span></span><code><span class="go">There are 30 section headers, starting at offset 0x3670:</span>

<span class="go">Section Headers:</span>
<span class="go">  [Nr] Name              Type            Address          Off    Size   ES Flg Lk Inf Al</span>
<span class="go">  [ 0]                   NULL            0000000000000000 000000 000000 00      0   0  0</span>
<span class="go">  [ 1] .interp           PROGBITS        0000000000400318 000318 00001c 00   A  0   0  1</span>
<span class="go">  [ 2] .note.gnu.property NOTE            0000000000400338 000338 000020 00   A  0   0  8</span>
<span class="go">  [ 3] .note.gnu.build-id NOTE            0000000000400358 000358 000024 00   A  0   0  4</span>
<span class="go">  [ 4] .note.ABI-tag     NOTE            000000000040037c 00037c 000020 00   A  0   0  4</span>
<span class="go">  [ 5] .gnu.hash         GNU_HASH        00000000004003a0 0003a0 00001c 00   A  6   0  8</span>
<span class="go">  [ 6] .dynsym           DYNSYM          00000000004003c0 0003c0 000060 18   A  7   1  8</span>
<span class="go">  [ 7] .dynstr           STRTAB          0000000000400420 000420 000050 00   A  0   0  1</span>
<span class="go">  [ 8] .gnu.version      VERSYM          0000000000400470 000470 000008 02   A  6   0  2</span>
<span class="go">  [ 9] .gnu.version_r    VERNEED         0000000000400478 000478 000030 00   A  7   1  8</span>
<span class="go">  [10] .rela.dyn         RELA            00000000004004a8 0004a8 000030 18   A  6   0  8</span>
<span class="go">  [11] .rela.plt         RELA            00000000004004d8 0004d8 000018 18  AI  6  23  8</span>
<span class="go">  [12] .init             PROGBITS        0000000000401000 001000 00001b 00  AX  0   0  4</span>
<span class="go">  [13] .plt              PROGBITS        0000000000401020 001020 000020 10  AX  0   0 16</span>
<span class="go">  [14] .text             PROGBITS        0000000000401040 001040 00014e 00  AX  0   0 16</span>
<span class="go">  [15] .fini             PROGBITS        0000000000401190 001190 00000d 00  AX  0   0  4</span>
<span class="go">  [16] .rodata           PROGBITS        0000000000402000 002000 00001f 00   A  0   0  4</span>
<span class="go">  [17] .eh_frame_hdr     PROGBITS        0000000000402020 002020 000034 00   A  0   0  4</span>
<span class="go">  [18] .eh_frame         PROGBITS        0000000000402058 002058 0000ac 00   A  0   0  8</span>
<span class="go">  [19] .init_array       INIT_ARRAY      0000000000403e10 002e10 000008 08  WA  0   0  8</span>
<span class="go">  [20] .fini_array       FINI_ARRAY      0000000000403e18 002e18 000008 08  WA  0   0  8</span>
<span class="go">  [21] .dynamic          DYNAMIC         0000000000403e20 002e20 0001d0 10  WA  7   0  8</span>
<span class="go">  [22] .got              PROGBITS        0000000000403ff0 002ff0 000010 08  WA  0   0  8</span>
<span class="go">  [23] .got.plt          PROGBITS        0000000000404000 003000 000020 08  WA  0   0  8</span>
<span class="go">  [24] .data             PROGBITS        0000000000404020 003020 000010 00  WA  0   0  8</span>
<span class="go">  [25] .bss              NOBITS          0000000000404030 003030 000008 00  WA  0   0  1</span>
<span class="go">  [26] .comment          PROGBITS        0000000000000000 003030 00002b 01  MS  0   0  1</span>
<span class="go">  [27] .symtab           SYMTAB          0000000000000000 003060 000348 18     28  18  8</span>
<span class="go">  [28] .strtab           STRTAB          0000000000000000 0033a8 0001b1 00      0   0  1</span>
<span class="go">  [29] .shstrtab         STRTAB          0000000000000000 003559 000116 00      0   0  1</span>
<span class="go">Key to Flags:</span>
<span class="go">  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),</span>
<span class="go">  L (link order), O (extra OS processing required), G (group), T (TLS),</span>
<span class="go">  C (compressed), x (unknown), o (OS specific), E (exclude),</span>
<span class="go">  D (mbind), l (large), p (processor specific)</span>
</code></pre></div>



</details>

<div class="highlight"><pre><span></span><code><span class="go">Section Headers:</span>
<span class="go">  [Nr] Name              Type            Address          Off    Size   ES Flg Lk Inf Al</span>
<span class="go">  ...</span>
<span class="go">  [12] .init             PROGBITS        0000000000401000 001000 00001b 00  AX  0   0  4</span>
<span class="go">  [13] .plt              PROGBITS        0000000000401020 001020 000020 10  AX  0   0 16</span>
<span class="go">  [14] .text             PROGBITS        0000000000401040 001040 00014e 00  AX  0   0 16</span>
<span class="go">  [15] .fini             PROGBITS        0000000000401190 001190 00000d 00  AX  0   0  4</span>
<span class="go">  ...</span>
</code></pre></div>

<h2>Symbol table</h2>
<p>Information about functions and global variables (aka symbols)
defined and referenced in our program lives in a symbol table in <code>.symtab</code> section.</p>
<blockquote>
<p>An object file's symbol table holds information needed to locate and relocate a program's symbolic definitions and references. https://www.man7.org/linux/man-pages/man5/elf.5.html</p>
</blockquote>
<p>This implies that we should be able to find
which symbol corresponds to memory <code>address: 4198694</code> or <code>0x401126</code> in hexadecimal form.
Let's inspect the symbol table.</p>
<div class="highlight"><pre><span></span><code><span class="go">﹩ readelf --symbols fib</span>
</code></pre></div>

<details>


<div class="highlight"><pre><span></span><code><span class="go">Symbol table &#39;.dynsym&#39; contains 4 entries:</span>
<span class="go">   Num:    Value          Size Type    Bind   Vis      Ndx Name</span>
<span class="go">     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND</span>
<span class="go">     1: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND _[...]@GLIBC_2.34 (2)</span>
<span class="go">     2: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__</span>
<span class="go">     3: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND [...]@GLIBC_2.3.4 (3)</span>

<span class="go">Symbol table &#39;.symtab&#39; contains 35 entries:</span>
<span class="go">   Num:    Value          Size Type    Bind   Vis      Ndx Name</span>
<span class="go">     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND</span>
<span class="go">     1: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS crt1.o</span>
<span class="go">     2: 000000000040037c    32 OBJECT  LOCAL  DEFAULT    4 __abi_tag</span>
<span class="go">     3: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS crtstuff.c</span>
<span class="go">     4: 0000000000401080     0 FUNC    LOCAL  DEFAULT   14 deregister_tm_clones</span>
<span class="go">     5: 00000000004010b0     0 FUNC    LOCAL  DEFAULT   14 register_tm_clones</span>
<span class="go">     6: 00000000004010f0     0 FUNC    LOCAL  DEFAULT   14 __do_global_dtors_aux</span>
<span class="go">     7: 0000000000404030     1 OBJECT  LOCAL  DEFAULT   25 completed.0</span>
<span class="go">     8: 0000000000403e18     0 OBJECT  LOCAL  DEFAULT   20 __do_global_dtor[...]</span>
<span class="go">     9: 0000000000401120     0 FUNC    LOCAL  DEFAULT   14 frame_dummy</span>
<span class="go">    10: 0000000000403e10     0 OBJECT  LOCAL  DEFAULT   19 __frame_dummy_in[...]</span>
<span class="go">    11: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS main.c</span>
<span class="go">    12: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS crtstuff.c</span>
<span class="go">    13: 0000000000402100     0 OBJECT  LOCAL  DEFAULT   18 __FRAME_END__</span>
<span class="go">    14: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS</span>
<span class="go">    15: 0000000000403e20     0 OBJECT  LOCAL  DEFAULT   21 _DYNAMIC</span>
<span class="go">    16: 0000000000402020     0 NOTYPE  LOCAL  DEFAULT   17 __GNU_EH_FRAME_HDR</span>
<span class="go">    17: 0000000000404000     0 OBJECT  LOCAL  DEFAULT   23 _GLOBAL_OFFSET_TABLE_</span>
<span class="go">    18: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __libc_start_mai[...]</span>
<span class="go">    19: 0000000000404020     0 NOTYPE  WEAK   DEFAULT   24 data_start</span>
<span class="go">    20: 0000000000404030     0 NOTYPE  GLOBAL DEFAULT   24 _edata</span>
<span class="go">    21: 0000000000401190     0 FUNC    GLOBAL HIDDEN    15 _fini</span>
<span class="go">    22: 0000000000404020     0 NOTYPE  GLOBAL DEFAULT   24 __data_start</span>
<span class="go">    23: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__</span>
<span class="go">    24: 0000000000404028     0 OBJECT  GLOBAL HIDDEN    24 __dso_handle</span>
<span class="go">    25: 0000000000402000     4 OBJECT  GLOBAL DEFAULT   16 _IO_stdin_used</span>
<span class="go">    26: 0000000000404038     0 NOTYPE  GLOBAL DEFAULT   25 _end</span>
<span class="go">    27: 0000000000401070     5 FUNC    GLOBAL HIDDEN    14 _dl_relocate_sta[...]</span>
<span class="go">    28: 0000000000401040    38 FUNC    GLOBAL DEFAULT   14 _start</span>
<span class="go">    29: 0000000000404030     0 NOTYPE  GLOBAL DEFAULT   25 __bss_start</span>
<span class="go">    30: 000000000040115a    52 FUNC    GLOBAL DEFAULT   14 main</span>
<span class="go">    31: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __printf_chk@GLI[...]</span>
<span class="go">    32: 0000000000404030     0 OBJECT  GLOBAL HIDDEN    24 __TMC_END__</span>
<span class="go">    33: 0000000000401000     0 FUNC    GLOBAL HIDDEN    12 _init</span>
<span class="go">    34: 0000000000401126    52 FUNC    GLOBAL DEFAULT   14 fibNaive</span>
</code></pre></div>



</details>

<div class="highlight"><pre><span></span><code><span class="go">Symbol table &#39;.symtab&#39; contains 35 entries:</span>
<span class="go">   Num:    Value          Size Type    Bind   Vis      Ndx Name</span>
<span class="go">   ...</span>
<span class="go">    34: 0000000000401126    52 FUNC    GLOBAL DEFAULT   14 fibNaive</span>
</code></pre></div>

<p>So here you go, <strong>fibNaive</strong> C function we were looking for:</p>
<ul>
<li><code>Value=0000000000401126</code> The symbol's absolute run-time address
  since it's an executable object file.
  For relocatable object files, it would be an offset from
  the beginning of the section defined by <code>Ndx=14</code>.</li>
<li><code>Size=52</code> The size of the function's code is 52 bytes.</li>
<li><code>Type=FUNC</code> The symbol is associated with a function.</li>
<li><code>Bind=GLOBAL</code> This indicates that the symbol is global,
  i.e., it can be referenced by other modules.</li>
<li><code>Vis=DEFAULT</code> Default symbol visibility rules apply:
  strong (functions and initialized global vars)
  and weak symbols (uninitialized global vars) are available to other modules.</li>
<li><code>Ndx=14</code> A symbol is "defined" in relation to <code>.text</code> section
  according to section header table index, see <code>readelf --sections fib</code>.</li>
<li><code>Name=fibNaive</code> The symbol name <code>fibNaive</code> was taken from
  string table in section <code>.strtab</code>, see <code>readelf --string-dump .strtab fib</code>.</li>
</ul>
<p>😌</p>
<p>Great, let's check the remaining memory addresses we've got in the pprof file
(I've sorted them for our convenience).
Unfortunately, I couldn't find corresponding symbols in <code>.symtab</code> section.</p>
<div class="highlight"><pre><span></span><code><span class="go">4198694 = 0x401126 fibNaive</span>
<span class="go">4198700 = 0x40112c ?</span>
<span class="go">4198705 = 0x401131 ?</span>
<span class="go">4198706 = 0x401132 ?</span>
<span class="go">4198707 = 0x401133 ?</span>
<span class="go">4198708 = 0x401134 ?</span>
<span class="go">4198712 = 0x401138 ?</span>
<span class="go">4198715 = 0x40113b ?</span>
<span class="go">4198719 = 0x40113f ?</span>
<span class="go">4198724 = 0x401144 ?</span>
<span class="go">4198727 = 0x401147 ?</span>
<span class="go">4198736 = 0x401150 ?</span>
<span class="go">4198739 = 0x401153 ?</span>
<span class="go">4198743 = 0x401157 ?</span>
<span class="go">4198744 = 0x401158 ?</span>
<span class="go">4198745 = 0x401159 ?</span>
</code></pre></div>

<p>What's interesting is that these addresses are within <code>Size=52</code> bytes
from <code>fibNaive</code> memory address, e.g.,
the distance to the highest address is 51 bytes = 4198745 - 4198694.</p>
<p>If we sort the symbols from <code>.symtab</code> section by <code>Value</code>,
we'll see that <code>fibNaive</code> is between <code>frame_dummy</code> and <code>main</code> symbols.
The rest of unresolved memory addresses from the samples
fit in between <code>fibNaive</code> and <code>main</code> symbols.</p>
<details>


<div class="highlight"><pre><span></span><code><span class="go">0000000 = 0x000000 crt1.o</span>
<span class="go">0000000 = 0x000000 crtstuff.c</span>
<span class="go">0000000 = 0x000000 main.c</span>
<span class="go">0000000 = 0x000000 crtstuff.c</span>
<span class="go">0000000 = 0x000000</span>
<span class="go">0000000 = 0x000000 __libc_start_main@GLIBC_2.34</span>
<span class="go">0000000 = 0x000000 __gmon_start__</span>
<span class="go">0000000 = 0x000000 __printf_chk@GLIBC_2.3.4</span>
<span class="go">4195196 = 0x40037c __abi_tag</span>
<span class="go">4198400 = 0x401000 _init</span>
<span class="go">4198464 = 0x401040 _start</span>
<span class="go">4198512 = 0x401070 _dl_relocate_static_pie</span>
<span class="go">4198528 = 0x401080 deregister_tm_clones</span>
<span class="go">4198576 = 0x4010b0 register_tm_clones</span>
<span class="go">4198640 = 0x4010f0 __do_global_dtors_aux</span>
<span class="go">4198688 = 0x401120 frame_dummy</span>
<span class="go">4198694 = 0x401126 fibNaive</span>
<span class="go">4198746 = 0x40115a main</span>
<span class="go">4198800 = 0x401190 _fini</span>
<span class="go">4202496 = 0x402000 _IO_stdin_used</span>
<span class="go">4202528 = 0x402020 __GNU_EH_FRAME_HDR</span>
<span class="go">4202752 = 0x402100 __FRAME_END__</span>
<span class="go">4210192 = 0x403e10 __frame_dummy_init_array_entry</span>
<span class="go">4210200 = 0x403e18 __do_global_dtors_aux_fini_array_entry</span>
<span class="go">4210208 = 0x403e20 _DYNAMIC</span>
<span class="go">4210688 = 0x404000 _GLOBAL_OFFSET_TABLE_</span>
<span class="go">4210720 = 0x404020 data_start</span>
<span class="go">4210720 = 0x404020 __data_start</span>
<span class="go">4210728 = 0x404028 __dso_handle</span>
<span class="go">4210736 = 0x404030 completed.0</span>
<span class="go">4210736 = 0x404030 _edata</span>
<span class="go">4210736 = 0x404030 __bss_start</span>
<span class="go">4210736 = 0x404030 __TMC_END__</span>
<span class="go">4210744 = 0x404038 _end</span>
</code></pre></div>



</details>

<div class="highlight"><pre><span></span><code><span class="go">0x401120 frame_dummy</span>
<span class="go">0x401126 fibNaive</span>
<span class="go">0x40112c ?</span>
<span class="go">0x401131 ?</span>
<span class="go">0x401132 ?</span>
<span class="go">0x401133 ?</span>
<span class="go">0x401134 ?</span>
<span class="go">0x401138 ?</span>
<span class="go">0x40113b ?</span>
<span class="go">0x40113f ?</span>
<span class="go">0x401144 ?</span>
<span class="go">0x401147 ?</span>
<span class="go">0x401150 ?</span>
<span class="go">0x401153 ?</span>
<span class="go">0x401157 ?</span>
<span class="go">0x401158 ?</span>
<span class="go">0x401159 ?</span>
<span class="go">0x40115a main</span>
</code></pre></div>

<p>Disassembling the program confirms that memory addresses in question
correspond to instructions of <code>fibNaive</code> function.</p>
<div class="highlight"><pre><span></span><code><span class="go">﹩ objdump --disassemble fib</span>
</code></pre></div>

<details>


<div class="highlight"><pre><span></span><code><span class="x">...</span>

<span class="mh">0000000000401120</span><span class="w"> </span><span class="p">&lt;</span><span class="nf">frame_dummy</span><span class="p">&gt;:</span>
<span class="x">  401120:   f3 0f 1e fa             endbr64</span>
<span class="x">  401124:   eb 8a                   jmp    4010b0 &lt;register_tm_clones&gt;</span>

<span class="mh">0000000000401126</span><span class="w"> </span><span class="p">&lt;</span><span class="nf">fibNaive</span><span class="p">&gt;:</span>
<span class="x">  401126:   48 83 ff 02             cmp    $0x2,%rdi</span>
<span class="x">  40112a:   7f 06                   jg     401132 &lt;fibNaive+0xc&gt;</span>
<span class="x">  40112c:   b8 01 00 00 00          mov    $0x1,%eax</span>
<span class="x">  401131:   c3                      ret</span>
<span class="x">  401132:   55                      push   %rbp</span>
<span class="x">  401133:   53                      push   %rbx</span>
<span class="x">  401134:   48 83 ec 08             sub    $0x8,%rsp</span>
<span class="x">  401138:   48 89 fb                mov    %rdi,%rbx</span>
<span class="x">  40113b:   48 8d 7f fe             lea    -0x2(%rdi),%rdi</span>
<span class="x">  40113f:   e8 e2 ff ff ff          call   401126 &lt;fibNaive&gt;</span>
<span class="x">  401144:   48 89 c5                mov    %rax,%rbp</span>
<span class="x">  401147:   48 8d 7b ff             lea    -0x1(%rbx),%rdi</span>
<span class="x">  40114b:   e8 d6 ff ff ff          call   401126 &lt;fibNaive&gt;</span>
<span class="x">  401150:   48 01 e8                add    %rbp,%rax</span>
<span class="x">  401153:   48 83 c4 08             add    $0x8,%rsp</span>
<span class="x">  401157:   5b                      pop    %rbx</span>
<span class="x">  401158:   5d                      pop    %rbp</span>
<span class="x">  401159:   c3                      ret</span>

<span class="mh">000000000040115a</span><span class="w"> </span><span class="p">&lt;</span><span class="nf">main</span><span class="p">&gt;:</span>
<span class="x">  40115a:   48 83 ec 08             sub    $0x8,%rsp</span>
<span class="x">  40115e:   bf 32 00 00 00          mov    $0x32,%edi</span>
<span class="x">  401163:   e8 be ff ff ff          call   401126 &lt;fibNaive&gt;</span>
<span class="x">  401168:   48 89 c1                mov    %rax,%rcx</span>
<span class="x">  40116b:   ba 32 00 00 00          mov    $0x32,%edx</span>
<span class="x">  401170:   be 04 20 40 00          mov    $0x402004,%esi</span>
<span class="x">  401175:   bf 01 00 00 00          mov    $0x1,%edi</span>
<span class="x">  40117a:   b8 00 00 00 00          mov    $0x0,%eax</span>
<span class="x">  40117f:   e8 ac fe ff ff          call   401030 &lt;__printf_chk@plt&gt;</span>
<span class="x">  401184:   b8 00 00 00 00          mov    $0x0,%eax</span>
<span class="x">  401189:   48 83 c4 08             add    $0x8,%rsp</span>
<span class="x">  40118d:   c3                      ret</span>

<span class="x">...</span>
</code></pre></div>



</details>

<div class="highlight"><pre><span></span><code><span class="mh">0000000000401126</span><span class="w"> </span><span class="p">&lt;</span><span class="nf">fibNaive</span><span class="p">&gt;:</span>
<span class="x">  401126:   48 83 ff 02             cmp    $0x2,%rdi</span>
<span class="x">  40112a:   7f 06                   jg     401132 &lt;fibNaive+0xc&gt;</span>
<span class="x">  40112c:   b8 01 00 00 00          mov    $0x1,%eax</span>
<span class="x">  401131:   c3                      ret</span>
<span class="x">  401132:   55                      push   %rbp</span>
<span class="x">  401133:   53                      push   %rbx</span>
<span class="x">  401134:   48 83 ec 08             sub    $0x8,%rsp</span>
<span class="x">  401138:   48 89 fb                mov    %rdi,%rbx</span>
<span class="x">  40113b:   48 8d 7f fe             lea    -0x2(%rdi),%rdi</span>
<span class="x">  40113f:   e8 e2 ff ff ff          call   401126 &lt;fibNaive&gt;</span>
<span class="x">  401144:   48 89 c5                mov    %rax,%rbp</span>
<span class="x">  401147:   48 8d 7b ff             lea    -0x1(%rbx),%rdi</span>
<span class="x">  40114b:   e8 d6 ff ff ff          call   401126 &lt;fibNaive&gt;</span>
<span class="x">  401150:   48 01 e8                add    %rbp,%rax</span>
<span class="x">  401153:   48 83 c4 08             add    $0x8,%rsp</span>
<span class="x">  401157:   5b                      pop    %rbx</span>
<span class="x">  401158:   5d                      pop    %rbp</span>
<span class="x">  401159:   c3                      ret</span>
</code></pre></div>

<p>It means that <code>bpf_get_stackid</code> we used in
<a href="https://github.com/marselester/diy-parca-agent/blob/main/cmd/profiler/bpf/parca-agent.bpf.c">profiler</a>
collected values stored in <code>rip</code> register,
i.e., memory addresses of machine instructions.</p>
<h2>PC to symbol address</h2>
<p>Since we have sorted symbol addresses from <code>.symtab</code>,
we can binary search them to find
whose instructions were executing when a sample was taken.</p>
<div class="highlight"><pre><span></span><code><span class="go">0x401120 frame_dummy</span>
<span class="go">0x401126 fibNaive</span>
<span class="go">0x40112c ?</span>
<span class="go">0x40115a main</span>
</code></pre></div>

<p>When the program counter (PC) contains instruction address <code>0x401126</code>,
then <code>fibNaive</code> function symbol is found in the symbol table.
When PC points to <code>0x40112c</code> instruction,
there is no match in the symbol table,
so the <code>main</code> symbol's predecessor is resolved
because binary search stops at <code>0x40115a</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">PC2SymbolAddress</span><span class="p">(</span><span class="nx">symbols</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">pc</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">lft</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">mid</span><span class="w"> </span><span class="kt">int</span><span class="w"></span>
<span class="w">    </span><span class="nx">rgt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">symbols</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">lft</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">rgt</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nx">mid</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">lft</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">rgt</span><span class="o">-</span><span class="nx">lft</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="w"></span>
<span class="w">        </span><span class="nx">symAddr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">symbols</span><span class="p">[</span><span class="nx">mid</span><span class="p">]</span><span class="w"></span>

<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nx">symAddr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">pc</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">symAddr</span><span class="w"></span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nx">symAddr</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">pc</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nx">lft</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nx">symAddr</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="nx">pc</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nx">rgt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">mid</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Since pc wasn&#39;t found in the array,</span><span class="w"></span>
<span class="w">    </span><span class="c1">// now mid points to symbol address &gt; pc, i.e., 0x40115a.</span><span class="w"></span>
<span class="w">    </span><span class="c1">//</span><span class="w"></span>
<span class="w">    </span><span class="c1">// 0x401120 frame_dummy</span><span class="w"></span>
<span class="w">    </span><span class="c1">// 0x401126 fibNaive</span><span class="w"></span>
<span class="w">    </span><span class="c1">// 0x40112c ?</span><span class="w"></span>
<span class="w">    </span><span class="c1">// 0x40115a main</span><span class="w"></span>
<span class="w">    </span><span class="c1">//</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Therefore the desired symbol&#39;s address is 0x401126.</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">mid</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">symbols</span><span class="p">[</span><span class="nx">mid</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>In reality symbolization is much more complicated.
Most likely you would have to resolve symbols in shared libraries,
and also deal with things like:</p>
<ul>
<li>Frame pointer or DWARF's Call Frame Information based stack walking, see
  <a href="https://blog.felixge.de/reducing-gos-execution-tracer-overhead-with-frame-pointer-unwinding/">Reducing Go Execution Tracer Overhead With Frame Pointer Unwinding</a> and
  <a href="https://www.polarsignals.com/blog/posts/2022/11/29/profiling-without-frame-pointers/">DWARF-based Stack Walking Using eBPF</a>.
  Alas, frame pointers are disabled by default in gcc,
  but you can enable them with the <code>-fno-omit-frame-pointer</code> flag.</li>
<li>Looking for symbols formatted in DWARF
  which could be part of an executable file or distributed separately,
  see <a href="https://www.polarsignals.com/blog/posts/2022/01/13/fantastic-symbols-and-where-to-find-them/">Fantastic Symbols and Where to Find Them</a>.
  The <code>-g</code> gcc flag produces debugging information in DWARF format.</li>
</ul>
<p>When profiling JIT-compiled code you would have to
look for symbols in <code>/tmp/perf-$PID.map</code> file, see
<a href="https://www.polarsignals.com/blog/posts/2022/01/27/fantastic-symbols-and-where-to-find-them-part-2/">Fantastic Symbols and Where to Find Them - Part 2</a>.</p>
<p class="subheader">Category: <a href="https://marselester.com/category/profiler.html">Profiler</a>

    Tagged: 
    <a href="https://marselester.com/tag/profiling.html">profiling </a>
</p>




	<h4>Comments</h4>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'marselester'
        var disqus_identifier = "diy-cpu-profiler-the-simplest-case-of-symbolization.html";
        var disqus_url = "https://marselester.com/diy-cpu-profiler-the-simplest-case-of-symbolization.html";

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</article>
    </div>
    <!-- End Main Content -->

    <!-- Sidebar -->
    <aside class="large-3 columns">
        <h5 class="sidebar-title">Site</h5>
        <ul class="side-nav">
            <li><a href="https://marselester.com/archives.html">Archives</a>
            <li><a href="https://marselester.com/tags.html">Tags</a>


                <li><a href="https://marselester.com/feeds/all.atom.xml" rel="alternate">Atom feed</a></li>
        </ul>

		
        <h5 class="sidebar-title">Categories</h5>
        <ul class="side-nav">
            <li><a href="https://marselester.com/category/go.html">Go</a></li>
            <li><a href="https://marselester.com/category/infrastructure.html">Infrastructure</a></li>
            <li><a href="https://marselester.com/category/misc.html">Misc</a></li>
            <li><a href="https://marselester.com/category/performance.html">Performance</a></li>
            <li><a href="https://marselester.com/category/profiler.html">Profiler</a></li>
            <li><a href="https://marselester.com/category/python.html">Python</a></li>
   
        </ul>

		
        <h5 class="sidebar-title">Social</h5>
        <ul class="side-nav">
            <li><a href="https://github.com/marselester">GitHub</a></li>
            <li><a href="https://www.instagram.com/marselester/">Instagram 📷</a></li>
            <li><a href="http://twitter.com/marselester">Twitter</a></li>
            <li><a href="https://medium.com/@marselester/">Medium</a></li>
        </ul>

    </aside> <!-- End Sidebar -->

</div> <!-- End Main Content and Sidebar -->


<!-- Footer -->
<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
                <p>marselester's blog by Marsel Mavletkulov</p>
            </div>
            </div>
    </div>
</footer>